<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>í‹° í…Œë¼í”¼ (Tea Therapy)</title>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* [1. ëª¨ë°”ì¼ ë ˆì´ì•„ì›ƒ ìµœì í™”] */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
    
    body { 
      background: url('./tea.jpeg') no-repeat center center fixed; 
      background-size: cover; 
      color: #333; 
      display: flex; justify-content: center; align-items: center; 
      min-height: 100dvh; padding: 12px; /* ì—¬ë°± ìµœì†Œí™” */
      backdrop-filter: blur(2px);
    }
    
    .wrap { width: 100%; max-width: 440px; margin: auto; }
    
    .card { 
      background: rgba(255, 255, 255, 0.96); 
      border-radius: 28px; 
      padding: 24px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
      min-height: 640px; 
      display: flex; flex-direction: column; 
      position: relative;
      overflow: hidden;
    }

    /* [2. í—¤ë” ë° ë„¤ë¹„ê²Œì´ì…˜] */
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    h1 { font-family: 'Nanum Pen Script', cursive; font-size: 30px; color: #2e7d32; line-height: 1.1; }
    .sub { font-size: 13px; color: #666; word-break: keep-all; }
    .home-btn { font-size: 22px; cursor: pointer; background: none; border: none; padding: 8px; border-radius: 50%; transition: background 0.2s; }
    .home-btn:active { background: #f0f0f0; }

    /* [3. ì§„í–‰ë°” ë° ì¸ë””ì¼€ì´í„°] */
    .pill { display: inline-block; padding: 5px 12px; background: #e8f5e9; color: #2e7d32; border-radius: 20px; font-size: 11px; font-weight: 700; margin-bottom: 8px; }
    .bar { width: 100%; height: 6px; background: #eee; border-radius: 10px; overflow: hidden; margin-bottom: 20px; }
    #barFill { height: 100%; background: #2f8a58; width: 0%; transition: width 0.5s ease-out; }

    /* [4. í˜¸í¡ ëª…ìƒ ì„¹ì…˜] */
    .breath-container { text-align: center; flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: space-between; }
    .guide-text { font-size: 15px; color: #444; line-height: 1.6; margin-bottom: 15px; word-break: keep-all; }
    
    .breath-options { display: flex; gap: 6px; width: 100%; margin-bottom: 20px; }
    .breath-opt-btn { 
      flex: 1; padding: 12px 4px; border-radius: 14px; border: 1.5px solid #eee; 
      background: #fff; font-size: 13px; cursor: pointer; transition: all 0.2s ease;
      display: flex; flex-direction: column; align-items: center; gap: 2px;
    }
    .breath-opt-btn strong { font-size: 11px; font-weight: 800; color: inherit; }
    .breath-opt-btn.active.theme-444 { border-color: #7DA2E1; color: #4a7ab5; background: #f4f8ff; }
    .breath-opt-btn.active.theme-478 { border-color: #8CCB9B; color: #2e7d32; background: #f4fff8; }
    .breath-opt-btn.active.theme-448 { border-color: #F8D06B; color: #a67c00; background: #fffdf2; }

    .breath-circle-wrap { flex: 1; min-height: 200px; display: flex; align-items: center; justify-content: center; position: relative; }
    .breath-circle { 
      width: 140px; height: 140px; border-radius: 50%; 
      display: flex; align-items: center; justify-content: center;
      color: white; font-family: 'Nanum Pen Script', cursive; font-size: 26px;
      transition: box-shadow 0.2s ease, background-color 0.6s ease;
      z-index: 5;
    }

    /* [5. ë°”ë”” ìŠ¤ìºë„ˆ ì„¹ì…˜] */
    .scanner-layout { display: flex; align-items: center; gap: 8px; flex: 1; margin: 10px 0; }
    .scanner-left { flex: 0 0 160px; position: relative; display: flex; justify-content: center; }
    .body-svg { width: 100%; height: auto; max-width: 160px; }
    .scanner-right { flex: 1; display: flex; flex-direction: column; gap: 8px; }
    .part-btn { 
      background: #fff; border: 1px solid #ddd; padding: 13px 10px; 
      border-radius: 14px; font-size: 13px; font-weight: 600; text-align: left;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.02);
    }
    .part-btn.active { background: #2f8a58; color: #fff; border-color: #2f8a58; transform: scale(1.02); }
    .hlt { opacity: 0; fill: rgba(47, 138, 88, 0.35); stroke: #2f8a58; stroke-width: 3; transition: opacity 0.3s; }
    .hlt.on { opacity: 1; }

    /* [6. ë²„íŠ¼ ë° ê²°ê³¼] */
    .btn { 
      width: 100%; padding: 18px; border-radius: 18px; border: none; 
      font-weight: 700; font-size: 16px; cursor: pointer; transition: 0.2s; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .btn:active { transform: scale(0.98); opacity: 0.9; }
    
    .btn-next { 
      margin-top: 15px; background: #fff; border: 1.5px dashed #ccc; 
      padding: 14px; border-radius: 16px; font-size: 14px; line-height: 1.4;
    }

    .result-box { 
      background: #fff; border-radius: 24px; padding: 28px 20px; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.04); text-align: center; flex: 1;
    }
    .reflection-box { 
      background: #f1f6fb; border-radius: 16px; padding: 18px; 
      margin-top: 20px; font-size: 14px; line-height: 1.7; text-align: left;
      border-left: 5px solid #7DA2E1; word-break: keep-all; color: #444;
    }

    .footer { text-align: center; margin-top: 20px; color: #bbb; font-size: 10px; letter-spacing: 0.5px; }

    /* ì‘ì€ í™”ë©´ ëŒ€ì‘ (iPhone SE ë“±) */
    @media (max-height: 670px) {
      .card { min-height: 580px; padding: 20px; }
      .breath-circle-wrap { min-height: 160px; }
      .breath-circle { width: 120px; height: 120px; font-size: 22px; }
      .scanner-left { flex: 0 0 140px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" id="app">
      <header>
        <div class="header-left">
          <h1 id="pageTitle">í‹° í…Œë¼í”¼</h1>
          <div class="sub" id="pageSub">ë‚˜ë¥¼ ëŒë³´ëŠ” ì‹œê°„</div>
        </div>
        <button class="home-btn" onclick="location.reload()" aria-label="ì²˜ìŒìœ¼ë¡œ">ğŸ </button>
      </header>

      <div id="statusInfo">
        <div class="pill" id="stepPill">Meditation</div>
        <div class="bar"><div id="barFill"></div></div>
      </div>

      <main id="mainContent" style="flex:1; display:flex; flex-direction:column;"></main>

      <div class="footer">
        <div>Â© ìì—°í™˜ê²½í•´ì„¤ì‚¬ ì •ì£¼í¬</div>
        <div style="margin-top:4px; opacity:0.8;">ëª¸ê³¼ ë§ˆìŒì˜ ì†Œë¦¬ì— ê·€ë¥¼ ê¸°ìš¸ì—¬ë³´ì„¸ìš”.</div>
      </div>
    </div>
  </div>

<script>
(() => {
  const THEMES = {
    '444': { color: '#7DA2E1', shadow: 'rgba(125, 162, 225, 0.6)', label: 'ì•ˆì •' },
    '478': { color: '#8CCB9B', shadow: 'rgba(140, 203, 155, 0.6)', label: 'ë¶ˆë©´' },
    '448': { color: '#F8D06B', shadow: 'rgba(248, 208, 107, 0.6)', label: 'í™œë ¥' }
  };

  const TEA_DB = {
    head: { label: "ë¨¸ë¦¬ / ì •ì‹ ", symptoms: [{ txt: "ìƒê°ì´ ë§ê³  ë¨¸ë¦¬ê°€ ë¬´ê±°ìš´ ìƒíƒœ", tea: "ë°•í•˜ì°¨", reflection: "ì°¨ë¥¼ í•œ ëª¨ê¸ˆ ë¨¸ê¸ˆê³ , ì½”ë¡œ ë‚˜ì˜¤ëŠ” ì‹œì›í•œ ë°”ëŒì— ë³µì¡í•œ ìƒê°ë“¤ì„ ì‹¤ì–´ ë³´ë‚´ ë³´ì„¸ìš”." }] },
    throat: { label: "ëª© / ê¸°ê´€ì§€", symptoms: [{ txt: "ëª©ì´ ë”°ê°‘ê³  ìˆ¨ì‰¬ê¸° ì¹¼ì¹¼í•œ ìƒíƒœ", tea: "ë„ë¼ì§€ì°¨", reflection: "ëª©ì„ íƒ€ê³  ë‚´ë ¤ê°€ëŠ” ì°¨ì˜ ë¶€ë“œëŸ¬ì›€ì„ ëŠë¼ë©° ìˆ¨ê²°ì„ ë‹¤ë“¬ì–´ ë³´ì„¸ìš”." }] },
    upper: { label: "ìœ—ë°° / ì†Œí™”", symptoms: [{ txt: "ì†ì´ ë”ë¶€ë£©í•˜ê³  ì†Œí™”ê°€ ì•ˆ ë˜ëŠ” ìƒíƒœ", tea: "ë§¤ì‹¤ì°¨", reflection: "ë‚´ ëª¸ì˜ ìˆœí™˜ì´ ë‹¤ì‹œ ì‹œì‘ë˜ëŠ” ê°ê°ì— ì§‘ì¤‘í•´ ë´…ë‹ˆë‹¤." }] },
    lower: { label: "ì•„ë«ë°° / ìˆœí™˜", symptoms: [{ txt: "ë°°ê°€ ì°¨ê°‘ê³  ì—ë„ˆì§€ê°€ ë§ºíŒ ìƒíƒœ", tea: "ìƒê°•ì°¨", reflection: "ì•„ë«ë°° ê¹Šì€ ê³³ê¹Œì§€ ë”°ëœ»í•œ ì˜¨ê¸°ê°€ ì „ë‹¬ë˜ëŠ” ê²ƒì„ ê´€ì°°í•˜ì„¸ìš”." }] },
    whole: { label: "ì „ì‹  / ê¸´ì¥", symptoms: [{ txt: "ì˜¨ëª¸ì´ ë»ê·¼í•˜ê³  ê¸´ì¥ì´ ë†’ì€ ìƒíƒœ", tea: "ëŒ€ì¶”ì°¨", reflection: "ì–´ê¹¨ì˜ í˜ì„ ë¹¼ê³  ìˆ²ì˜ ê³ ìš”í•¨ì´ ëª¸ ì•ˆìœ¼ë¡œ ë“¤ì–´ì˜¨ë‹¤ê³  ìƒìƒí•´ ë³´ì„¸ìš”." }] }
  };

  let state = { view: 'intro', breathType: '444', isBreathing: false, selectedCategory: null };

  function render() {
    const main = document.getElementById("mainContent");
    const fill = document.getElementById("barFill");
    const pill = document.getElementById("stepPill");

    if (state.view === 'intro') {
      pill.textContent = "Meditation";
      fill.style.width = '10%';
      main.innerHTML = `
        <div class="breath-container">
          <p class="guide-text">í¸ì•ˆí•˜ê²Œ ì•‰ì•„ í˜¸í¡ ë¦¬ë“¬ì„ ì„ íƒí•œ í›„<br><strong>ì‹œì‘</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
          
          <div class="breath-options">
            <button class="breath-opt-btn theme-444 ${state.breathType==='444'?'active':''}" onclick="setBreath('444')">444 í˜¸í¡<strong>ì•ˆì •</strong></button>
            <button class="breath-opt-btn theme-478 ${state.breathType==='478'?'active':''}" onclick="setBreath('478')">478 í˜¸í¡<strong>ë¶ˆë©´</strong></button>
            <button class="breath-opt-btn theme-448 ${state.breathType==='448'?'active':''}" onclick="setBreath('448')">448 í˜¸í¡<strong>í™œë ¥</strong></button>
          </div>

          <div class="breath-circle-wrap">
            <div id="breathCircle" class="breath-circle" 
                 style="background-color:${THEMES[state.breathType].color}; box-shadow: 0 0 10px ${THEMES[state.breathType].shadow};">
                 ì¤€ë¹„
            </div>
          </div>

          <button id="breathActionBtn" class="btn" style="background-color:${THEMES[state.breathType].color}; color:white;" onclick="toggleBreath()">ì‹œì‘í•˜ê¸°</button>
          
          <div id="nextStepArea" style="visibility:hidden; width:100%;">
            <button class="btn-next" style="width:100%; border-color:${THEMES[state.breathType].color}; color:${THEMES[state.breathType].color};" onclick="setView('scanner_parts')">
                <strong>í˜¸í¡ì„ ë§ˆì³¤ìŠµë‹ˆë‹¤</strong><br>ë‚´ ëª¸ì˜ ì‹ í˜¸ ì²´í¬í•˜ê¸°
            </button>
          </div>
        </div>
      `;
    } 
    else if (state.view === 'scanner_parts') {
      pill.textContent = "Body Scan";
      fill.style.width = '50%';
      document.getElementById("pageSub").textContent = "ê°ê° ìŠ¤ìºë‹";
      main.innerHTML = `
        <div class="scanner-layout">
          <div class="scanner-left">
            <img src="./dambi.png" class="body-svg" alt="ë°”ë””ìºë¦­í„°">
            <svg class="body-svg" viewBox="0 0 200 320" style="position:absolute; top:0; left:0; pointer-events:none;">
                <circle id="hlt-head" class="hlt" cx="130" cy="50" r="40" />
                <rect id="hlt-throat" class="hlt" x="115" y="85" width="30" height="20" rx="5" />
                <rect id="hlt-upper" class="hlt" x="105" y="115" width="50" height="35" rx="8" />
                <rect id="hlt-lower" class="hlt" x="105" y="155" width="50" height="40" rx="8" />
                <ellipse id="hlt-whole" class="hlt" cx="130" cy="110" rx="55" ry="90" />
            </svg>
          </div>
          <div class="scanner-right">
            ${Object.keys(TEA_DB).map(k => `
                <button id="btn-${k}" class="part-btn" onclick="selectPart('${k}')" onmouseenter="setHighlight('${k}',true)" onmouseleave="setHighlight('${k}',false)">
                    ${TEA_DB[k].label} <span style="opacity:0.3; font-size:10px;">â–¶</span>
                </button>
            `).join('')}
          </div>
        </div>
        <button class="btn-next" style="margin-top:20px; border-style:solid;" onclick="setView('intro')">ì´ì „ìœ¼ë¡œ (í˜¸í¡í•˜ê¸°)</button>
      `;
    }
    else if (state.view === 'scanner_symptoms') {
        pill.textContent = "Symptoms";
        fill.style.width = '80%';
        const data = TEA_DB[state.selectedCategory];
        main.innerHTML = `<div style="margin-top:10px; flex:1;">${data.symptoms.map((s,i) => `
            <button class="btn" style="background:#fff; border:1px solid #ddd; text-align:left; margin-bottom:12px; font-weight:500; font-size:15px; line-height:1.4; color:#333;" onclick="showResult(${i})">${s.txt}</button>
        `).join('')}</div>
        <button class="btn" style="background:#f5f5f5; color:#666; font-size:14px;" onclick="setView('scanner_parts')">ë¶€ìœ„ ë‹¤ì‹œ ì„ íƒ</button>`;
    }
    else if (state.view === 'result') {
        pill.textContent = "Prescription";
        fill.style.width = '100%';
        const res = state.selectedResult;
        main.innerHTML = `
          <div class="result-box">
            <span style="font-size:11px; color:#2e7d32; font-weight:bold; letter-spacing:1px; opacity:0.7;">TODAY'S TEA</span>
            <h2 style="font-family:'Nanum Pen Script'; font-size:38px; color:#111; margin:12px 0;">${res.tea}</h2>
            <div class="reflection-box">
              <strong style="display:block; margin-bottom:8px; color:#2e7d32; font-size:15px;">ğŸŒ¿ í•´ì„¤ì‚¬ì˜ ì„±ì°° ê°€ì´ë“œ</strong>
              ${res.reflection}
            </div>
          </div>
          <button class="btn" style="margin-top:20px; background:#2e7d32; color:white;" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        `;
    }
  }

  window.setBreath = (type) => { if (state.isBreathing) return; state.breathType = type; render(); };
  window.toggleBreath = () => {
    const btn = document.getElementById('breathActionBtn');
    const circle = document.getElementById('breathCircle');
    const nextArea = document.getElementById('nextStepArea');
    if (state.isBreathing) {
      state.isBreathing = false;
      btn.textContent = "ë‹¤ì‹œ ì‹œì‘";
      circle.textContent = "ì¤€ë¹„";
      circle.style.boxShadow = `0 0 10px ${THEMES[state.breathType].shadow}`;
    } else {
      state.isBreathing = true;
      btn.textContent = "ê·¸ë§Œí•˜ê¸°";
      nextArea.style.visibility = "visible";
      runBreathCycle();
    }
  };

  function runBreathCycle() {
    const circle = document.getElementById('breathCircle');
    const configs = { '444': [4, 4, 4], '478': [4, 7, 8], '448': [4, 4, 8] };
    const [inhale, hold, exhale] = configs[state.breathType];
    const shadowColor = THEMES[state.breathType].shadow;
    function cycle() {
      if (!state.isBreathing) return;
      circle.textContent = "ë“¤ì´ë§ˆì‹œê¸°";
      circle.style.transition = `box-shadow ${inhale}s linear`;
      circle.style.boxShadow = `0 0 80px 40px ${shadowColor}`;
      setTimeout(() => {
        if (!state.isBreathing) return;
        circle.textContent = "ë©ˆì¶”ê¸°";
        circle.style.transition = "none";
        setTimeout(() => {
          if (!state.isBreathing) return;
          circle.textContent = "ë‚´ì‰¬ê¸°";
          circle.style.transition = `box-shadow ${exhale}s linear`;
          circle.style.boxShadow = `0 0 10px 0px ${shadowColor}`;
          setTimeout(cycle, exhale * 1000);
        }, hold * 1000);
      }, inhale * 1000);
    }
    cycle();
  }

  window.setView = (v) => { state.view = v; render(); };
  window.selectPart = (k) => { state.selectedCategory = k; setView('scanner_symptoms'); };
  window.showResult = (i) => { state.selectedResult = TEA_DB[state.selectedCategory].symptoms[i]; setView('result'); };
  window.setHighlight = (key, on) => { 
    const el = document.getElementById('hlt-' + key);
    if(el) el.classList.toggle('on', on);
    const btn = document.getElementById('btn-' + key);
    if(btn) btn.classList.toggle('active', on);
  };

  render();
})();
</script>
</body>
</html>