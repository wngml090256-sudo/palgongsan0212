
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  
  <title>ì—ì„¼ì…œ ì˜¤ì¼ í…Œë¼í”¼</title>
  <meta property="og:title" content="ì—ì„¼ì…œ ì˜¤ì¼ í…Œë¼í”¼" />
  <meta property="og:description" content="ë‚˜ì—ê²Œ ë§ëŠ” í–¥ê¸°ë¥¼ ì°¾ê³ , DIY ë ˆì‹œí”¼ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”." />
  <meta property="og:image" content="https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?q=80&w=1200&auto=format&fit=crop" />

  <!-- í°íŠ¸ ë¡œë“œ -->
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Pretendard:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root {
      /* ë°°ê²½ì€ ì´ë¯¸ì§€ë¡œ ëŒ€ì²´ë˜ë¯€ë¡œ bg-colorëŠ” í´ë°±ìš© */
      --bg-color: #F9F7F2; 
      --card-bg: rgba(255, 255, 255, 0.95); /* ë°°ê²½ì´ ì‚´ì§ ë¹„ì¹˜ëŠ” ë¶ˆíˆ¬ëª… í°ìƒ‰ */
      --primary: #4A6C56; /* ì„¸ì´ì§€ ê·¸ë¦° */
      --primary-dark: #35503D;
      --accent: #D4A024; /* ê³¨ë“œ */
      --text-main: #2C2C2C;
      --text-sub: #666666;
      --border-radius: 20px;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      --font-main: 'Pretendard', sans-serif;
      --font-hand: 'Nanum Pen Script', cursive;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    body {
      /* ìˆ² ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì • */
      background: url(forest.jpeg) no-repeat center center fixed;
      background-size: cover;
      font-family: var(--font-main);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      min-height: 100vh;
      line-height: 1.5;
    }

    /* ë°°ê²½ ì˜¤ë²„ë ˆì´ (í…ìŠ¤íŠ¸ ê°€ë…ì„±ì„ ìœ„í•´ ì–´ë‘¡ê²Œ ì²˜ë¦¬í•˜ê³  ì‹¶ìœ¼ë©´ ì£¼ì„ í•´ì œ) */
    /* body::before {
      content: ""; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.2); z-index: -1;
    } */

    .wrap {
      width: 100%;
      max-width: 480px; /* ëª¨ë°”ì¼ ìµœì í™” ë„ˆë¹„ */
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(10px); /* ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ íš¨ê³¼ */
      -webkit-backdrop-filter: blur(10px);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 30px 24px;
      position: relative;
      overflow: hidden;
      min-height: 80vh;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }

    /* í—¤ë” ì˜ì—­ */
    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 24px;
    }

    .header-left h1 {
      font-family: var(--font-hand);
      font-size: 2.2rem;
      color: var(--primary);
      margin-bottom: 4px;
      line-height: 1.1;
    }

    .sub {
      font-size: 0.9rem;
      color: var(--text-sub);
      font-weight: 400;
    }

    .header-right {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      background: rgba(0,0,0,0.05);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      font-size: 1.2rem;
    }
    .icon-btn svg { width: 18px; height: 18px; color: #555; }
    .icon-btn:hover { background: rgba(0,0,0,0.1); }

    /* ì§„í–‰ë°” */
    .progress-area { margin-bottom: 24px; }
    .pill {
      display: inline-block;
      background: var(--primary);
      color: white;
      font-size: 0.75rem;
      padding: 4px 12px;
      border-radius: 20px;
      margin-bottom: 8px;
      font-weight: 600;
    }
    .bar {
      width: 100%;
      height: 6px;
      background: #EAEAEA;
      border-radius: 3px;
      overflow: hidden;
    }
    #barFill {
      height: 100%;
      background: var(--primary);
      width: 0%;
      transition: width 0.4s cubic-bezier(0.25, 1, 0.5, 1);
    }

    /* ë©”ì¸ ì½˜í…ì¸  */
    #mainContent {
      flex: 1;
      display: flex;
      flex-direction: column;
      animation: fadeIn 0.4s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ë²„íŠ¼ ê³µí†µ */
    .btn {
      padding: 14px 20px;
      border-radius: 12px;
      border: none;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      background: #F0F0F0;
      color: var(--text-main);
    }
    .btn.primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(74, 108, 86, 0.3); }
    .btn.primary:active { transform: scale(0.98); }
    .btn.accent { background: var(--accent); color: white; }
    .btn.danger { background: #fff; border: 1px solid #ffcccc; color: #d32f2f; }
    .btn.capture { background: #333; color: #fff; }

    /* ë©”ë‰´ ë²„íŠ¼ */
    .choices { display: flex; flex-direction: column; gap: 12px; }
    .choice {
      background: #FFFFFF;
      border: 1px solid #EAEAEA;
      padding: 18px;
      border-radius: 16px;
      text-align: left;
      font-size: 1rem;
      color: var(--text-main);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    }
    .choice:hover { border-color: var(--primary); background: #F7FAF8; transform: translateY(-2px); }
    .choice.clicked { background: var(--primary); color: white; border-color: var(--primary); }

    /* ì·¨í–¥ ì´ë¯¸ì§€ ê·¸ë¦¬ë“œ */
    .pref-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .pref-card {
      background: #FFF;
      border: 1px solid #EAEAEA;
      border-radius: 16px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .pref-card:hover { border-color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    .pref-card.clicked { border-color: var(--primary); background: #EFF5F1; }
    
    /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
    .pref-img { 
      width: 100px; 
      height: 100px; 
      object-fit: contain; 
      margin-bottom: 12px; 
      /* ì´ë¯¸ì§€ê°€ ë„ˆë¬´ íŠ€ì§€ ì•Šê²Œ ì•½ê°„ ë¶€ë“œëŸ½ê²Œ */
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05)); 
    }
    
    .pref-name { font-weight: 700; color: var(--text-main); margin-bottom: 4px; }
    .pref-desc { font-size: 0.75rem; color: #888; line-height: 1.3; }

    /* ì§ˆë¬¸ ìŠ¤íƒ€ì¼ */
    .q-title {
      font-size: 1.35rem;
      font-weight: 700;
      margin-bottom: 24px;
      word-break: keep-all;
      color: var(--text-main);
    }

    /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
    .nav {
      margin-top: auto;
      padding-top: 24px;
      display: flex;
      gap: 10px;
    }
    .nav .btn { flex: 1; }

    /* ê²°ê³¼ í˜ì´ì§€ */
    .result-section {
        background: rgba(255,255,255,0.5);
        border-radius: 16px;
    }
    .analysis-box {
        background: #F7FAF8;
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid var(--primary);
    }
    .analysis-title { font-weight: 700; font-size: 1.1rem; color: var(--primary); margin-bottom: 10px; }
    .analysis-text { font-size: 0.95rem; color: #555; line-height: 1.6; }
    
    .persona-card {
        background: #FFF8E1; /* ì—°í•œ ë…¸ë‘ */
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 24px;
        text-align: center;
    }
    .persona-title { font-weight: 700; color: #D4A024; margin-bottom: 8px; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
    .persona-desc { font-size: 1rem; line-height: 1.5; color: #4e342e; }

    .empathy-msg {
        text-align: center;
        font-family: var(--font-hand);
        font-size: 1.8rem;
        color: var(--text-sub);
        margin: 30px 0 20px;
    }

    /* ì˜¤ì¼ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    #oil-list { display: flex; flex-direction: column; gap: 12px; margin-bottom: 30px; }
    .oil-card {
        display: flex;
        align-items: center;
        background: #fff;
        border: 1px solid #eee;
        padding: 16px;
        border-radius: 14px;
        transition: transform 0.2s;
    }
    .oil-card.best {
        border: 1px solid var(--accent);
        background: #FFFEFA;
        box-shadow: 0 4px 15px rgba(212, 160, 36, 0.15);
        transform: scale(1.02);
    }

    /* ë ˆì‹œí”¼ ì„ íƒ ê·¸ë¦¬ë“œ */
    .selection-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-bottom: 24px;
    }
    .oil-select-item {
        background: #fff;
        border: 1px solid #eaeaea;
        border-radius: 12px;
        padding: 12px 4px;
        text-align: center;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    .oil-select-item.selected {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }
    
    .recipe-intro-btn {
        background: #fff;
        border: 1px solid #eaeaea;
        padding: 24px;
        border-radius: 16px;
        text-align: left;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 10px rgba(0,0,0,0.02);
    }
    .recipe-intro-btn:hover { border-color: var(--primary); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
    .recipe-intro-btn strong { display: block; font-size: 1.1rem; margin-bottom: 6px; color: var(--text-main); }
    .recipe-intro-btn span { font-size: 0.9rem; color: #888; }

    .wide-btn {
        width: 100%;
        padding: 16px;
        border-radius: 14px;
        border: none;
        font-size: 1rem;
        margin-top: 10px;
        cursor: pointer;
        transition: 0.2s;
    }

    .drop-row {
        display: flex;
        justify-content: space-between;
        padding: 12px;
        border-bottom: 1px dashed #ddd;
    }
    .drop-row:last-child { border-bottom: none; }
    
    .recipe-box {
        background: #FFF;
        border: 2px dashed #AACCAE;
        padding: 20px;
        border-radius: 16px;
    }

    /* í‘¸í„° */
    .footer {
      margin-top: 40px;
      text-align: center;
      font-size: 0.75rem;
      color: #888;
      padding-bottom: 10px;
    }

    /* ëª¨ë‹¬ */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex; justify-content: center; align-items: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }
    .hidden { display: none !important; }
    .modal-box {
      background: white;
      padding: 24px;
      border-radius: 20px;
      width: 90%;
      max-width: 320px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    .qr-img { width: 100%; max-width: 180px; margin: 16px 0; border-radius: 8px; }
    .url-input {
      width: 100%; padding: 10px; background: #f5f5f5; border: none;
      border-radius: 8px; margin-bottom: 16px; font-size: 0.85rem; color: #555;
    }

  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">
      <header>
        <div class="header-left">
          <h1 id="pageTitle">ì—ì„¼ì…œ ì˜¤ì¼ í…Œë¼í”¼</h1>
          <div class="sub" id="pageSub">ì›í•˜ëŠ” ë©”ë‰´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</div>
        </div>
        <div class="header-right">
          <!-- í™ˆ ë²„íŠ¼ -->
          <button class="icon-btn" onclick="location.href='index.html'">ğŸ </button>
          <!-- ê³µìœ  ë²„íŠ¼ -->
          <button class="icon-btn" onclick="openShareModal()" aria-label="ê³µìœ í•˜ê¸°">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3"></circle>
              <circle cx="6" cy="12" r="3"></circle>
              <circle cx="18" cy="19" r="3"></circle>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
          </button>
        </div>
      </header>
      
      <div class="progress-area">
          <div class="pill" id="stepPill">Oil</div>
          <div class="bar"><div id="barFill"></div></div>
      </div>

      <main id="mainContent"></main>

      <div class="footer">
        <div>Â© ìì—°í™˜ê²½í•´ì„¤ì‚¬ ì •ì£¼í¬</div>
        <div>* ì˜í•™ì  ì§„ë‹¨ì´ ì•„ë‹Œ ì·¨í–¥/ì»¨ë””ì…˜ ê¸°ë°˜ ì¶”ì²œì…ë‹ˆë‹¤.</div>
      </div>
    </div>
  </div>

  <!-- ê³µìœ  ëª¨ë‹¬ì°½ -->
  <div id="shareModal" class="modal-overlay hidden" onclick="closeShareModal(event)">
    <div class="modal-box" onclick="event.stopPropagation()">
      <h3 style="margin-bottom:10px;">QRì½”ë“œ ê³µìœ </h3>
      <div style="font-size:12px; color:#888;">ì¹œêµ¬ì—ê²Œ í–¥ê¸°ë¥¼ ì„ ë¬¼í•˜ì„¸ìš”</div>
      <img id="qrImage" src="" alt="QR Code" class="qr-img">
      <input type="text" id="shareUrlInput" class="url-input" readonly>
      <div style="display:flex; gap:8px;">
        <button class="btn primary" style="flex:1" onclick="copyShareUrl()">ì£¼ì†Œ ë³µì‚¬</button>
        <button class="btn" style="flex:1" onclick="closeShareModal()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

<script>
(() => {
  const OIL_DATA = [
      { name: "ë¼ë²¤ë”", category: "Floral", note: "M", tags: ["íœ´ì‹", "ìˆ˜ë©´"], desc: "ë§ì€ ë°°ë ¤ë¡œ ì§€ì¹˜ì…¨êµ°ìš”. ì§€ê¸ˆì€ ì—„ë§ˆ í’ˆ ê°™ì€ ì˜¨ì „í•œ ì‰¼ì´ í•„ìš”í•´ìš”.", scentDesc: "ë³´ëë¹› ê½ƒë°­ì´ ë°”ëŒì— í©ë‚ ë¦¬ëŠ” ë“¯í•œ í¸ì•ˆí•œ í–¥" },
      { name: "ì¼ë‘ì¼ë‘", category: "Floral", note: "B", tags: ["ë§¤í˜¹", "ê°ê°"], desc: "ê°ì„±ì´ í’ë¶€í•œ ë‹¹ì‹ , ì–µëˆŒë¦° ê°ì •ì„ ë¡œë§¨í‹±í•˜ê²Œ í‘œí˜„í•´ë³´ì„¸ìš”.", scentDesc: "ë‹¬ì½¤í•˜ê³  ë¬µì§í•˜ê²Œ í”¼ì–´ì˜¤ë¥´ëŠ” ê´€ëŠ¥ì ì¸ ê½ƒí–¥ê¸°" },
      { name: "ììŠ¤ë¯¼", category: "Floral", note: "B", tags: ["ìš°ì•„", "ì‹ ë¢°"], desc: "ë‹¹ì‹ ì€ ì´ë¯¸ ê³ ê·€í•œ ì‚¬ëŒì…ë‹ˆë‹¤. ìŠ¤ìŠ¤ë¡œë¥¼ ë” ë¯¿ì–´ì£¼ì„¸ìš”.", scentDesc: "ë‹¬ë¹› ì•„ë˜ í•€ í•˜ì–€ ê½ƒì²˜ëŸ¼ ê·¸ìœ½í•˜ê³  ê¹Šì€ í–¥" },
      { name: "ë¡œì¦ˆ", category: "Floral", note: "M", tags: ["ì‚¬ë‘", "í–‰ë³µ"], desc: "ë§ˆìŒ ê¹Šì€ ê³³ ë”°ëœ»í•œ ì‚¬ë‘ì´ í•„ìš”í•˜ì‹œêµ°ìš”. ìƒì²˜ë¥¼ ë¶€ë“œëŸ½ê²Œ ê°ì‹¸ì£¼ì„¸ìš”.", scentDesc: "ìˆ˜ì²œ ì†¡ì´ ì¥ë¯¸ ê½ƒìì— íŒŒë¬»íŒ ë“¯í•œ í’ì„±í•œ í–¥" },
      { name: "ë„¤ë¡¤ë¦¬", category: "Floral", note: "M", tags: ["ìˆœìˆ˜", "ì•ˆì‹"], desc: "ì—¬ë¦° ë§ˆìŒì„ ë‹¤ì¹˜ì…¨ë‚˜ìš”? ê¹Šì€ ìŠ¬í””ì„ ë¶€ë“œëŸ½ê²Œ ì–´ë£¨ë§Œì ¸ ì£¼ì„¸ìš”.", scentDesc: "ì˜¤ë Œì§€ ê½ƒì—ì„œ ë°°ì–´ë‚˜ì˜¤ëŠ” ì„¬ì„¸í•˜ê³  ì²­ì´ˆí•œ í–¥" },
      { name: "ì œë¼ëŠ„", category: "Floral", note: "M", tags: ["ê· í˜•", "ì•ˆì •"], desc: "ê°ì •ì˜ ë¡¤ëŸ¬ì½”ìŠ¤í„° ì†ì—ì„œ í‰ì •ì‹¬ì„ ì°¾ê³  ì‹¶ìœ¼ì‹œêµ°ìš”.", scentDesc: "ì¥ë¯¸ì™€ í’€ë‚´ìŒì´ ì„ì¸ ë“¯í•œ ì‹±ê·¸ëŸ¬ìš´ ê½ƒí–¥ê¸°" },
      { name: "ë² ë¥´ê°€ëª»", category: "Citrus", note: "T", tags: ["ë°ìŒ", "í¬ë§"], desc: "ê½‰ ë§‰íŒ ë§ˆìŒì„ í’€ì–´ì£¼ê³  í–‡ì‚´ ê°™ì€ í¬ë§ì„ ì±„ì›Œë³´ì„¸ìš”.", scentDesc: "í™ì°¨(ì–¼ê·¸ë ˆì´)ì— ë‹´ê¸´ ë“¯í•œ ê³ ê¸‰ìŠ¤ëŸ½ê³  ìŒ‰ìŒ€í•œ ê·¤í–¥" },
      { name: "ë ˆëª¬ê·¸ë¼ìŠ¤", category: "Citrus", note: "T", tags: ["í™œë ¥", "ìê·¹"], desc: "ë¬´ê¸°ë ¥í•¨ì„ ëŠë¼ì‹œë‚˜ìš”? ì•¼ìƒì˜ ìƒëª…ë ¥ì´ ë‹¹ì‹ ì„ ê¹¨ì›Œì¤„ ê±°ì˜ˆìš”.", scentDesc: "í™ë‚´ìŒì´ ì„ì¸ ê±°ì¹ ê³  ê°•ë ¬í•œ ë ˆëª¬ í’€í–¥" },
      { name: "ìŠ¤ìœ„íŠ¸ì˜¤ë Œì§€", category: "Citrus", note: "T", tags: ["ì›ƒìŒ", "ì²œì§„"], desc: "ê±±ì •ì€ ë‚´ë ¤ë†“ê³  ì•„ì´ì²˜ëŸ¼ í•´ë§‘ê²Œ ì›ƒê³  ì‹¶ì€ ë‚ ì´êµ°ìš”.", scentDesc: "ê»ì§ˆì„ ë§‰ ê¹ ì„ ë•Œ í¼ì§€ëŠ” ë‹¬ì½¤í•˜ê³  ìƒí¼í•œ ê³¼ì¦™í–¥" },
      { name: "ë¼ì„", category: "Citrus", note: "T", tags: ["ì¬ì¹˜", "ê°€ë²¼ì›€"], desc: "ì‚¶ì´ ë„ˆë¬´ ë¬´ê²ë‚˜ìš”? íƒ„ì‚°ìˆ˜ì²˜ëŸ¼ ê°€ë³ê³  ìœ ì¾Œí•˜ê²Œ ê¸°ë¶„ ì „í™˜í•˜ì„¸ìš”.", scentDesc: "ì…ì•ˆì— ì¹¨ì´ ê³ ì´ê²Œ í•˜ëŠ” ì¨í•˜ê³  ìŒ‰ì‹¸ë¦„í•œ ë¼ì„í–¥" },
      { name: "ë ˆëª¬", category: "Citrus", note: "T", tags: ["ìƒì¾Œ", "ì‹œì‘"], desc: "ì§€ë£¨í•œ ì¼ìƒì„ ëë‚´ê³  ë§‘ì€ ì—ë„ˆì§€ë¡œ ìƒˆë¡œ ì‹œì‘í•˜ê³  ì‹¶ìœ¼ì‹œêµ°ìš”.", scentDesc: "ì •ì‹ ì´ ë²ˆì© ë“¤ ë§Œí¼ ì‹œê³  ìƒì¾Œí•œ ë…¸ë€ìƒ‰ í–¥ê¸°" },
      { name: "ë¡œì¦ˆë§ˆë¦¬", category: "Herb", note: "T", tags: ["ê¸°ì–µ", "ì„ ëª…"], desc: "ìƒê°ì´ ë„ˆë¬´ ë§ìœ¼ì‹œêµ°ìš”. ì•ˆê°œë¥¼ ê±·ì–´ë‚´ê³  ì •ì‹ ì„ ë§‘ê²Œ ê¹¨ì›Œë³´ì„¸ìš”.", scentDesc: "ë¨¸ë¦¬ê°€ ë§‘ì•„ì§€ëŠ” í†¡ ì˜ëŠ” í‘¸ë¥¸ í—ˆë¸Œì˜ í–¥" },
      { name: "ìœ ì¹¼ë¦½íˆ¬ìŠ¤", category: "Herb", note: "T", tags: ["ì •í™”", "ì‹œì›"], desc: "ë‹µë‹µí•œ ìƒí™©ì— ê°‡íŒ ê¸°ë¶„ì¸ê°€ìš”? ì‹œì›í•œ ë°”ëŒìœ¼ë¡œ í™˜ê¸°ê°€ í•„ìš”í•´ìš”.", scentDesc: "ì½”ê°€ ë»¥ ëš«ë¦¬ëŠ” ë“¯í•œ ì‹œì›í•˜ê³  ì²­ëŸ‰í•œ ìˆ²ì˜ í–¥" },
      { name: "í˜í¼ë¯¼íŠ¸", category: "Herb", note: "T", tags: ["ê¹¨ì–´ë‚¨", "ì¶©ê²©"], desc: "ë‚˜íƒœí•´ì§„ ì •ì‹ ì— ì°¬ë¬¼ ê°™ì€ ìê·¹ê³¼ ìƒˆë¡œìš´ ì—ë„ˆì§€ë¥¼ ì£¼ì„¸ìš”.", scentDesc: "ë°•í•˜ì‚¬íƒ•ì²˜ëŸ¼ í™”í•˜ê³  ì°¨ê°€ìš´ ë©˜í†¨ì˜ í–¥" },
      { name: "í‹°íŠ¸ë¦¬", category: "Herb", note: "T", tags: ["ë°©ì–´", "ì²­ê²°"], desc: "ì™¸ë¶€ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œë¶€í„° ë‚˜ë¥¼ ì§€í‚¬ ë‹¨ë‹¨í•œ ë°©íŒ¨ê°€ í•„ìš”í•˜êµ°ìš”.", scentDesc: "ì•½ì´ˆì²˜ëŸ¼ ìŒ‰ì‹¸ë¦„í•˜ê³  ê¹¨ë—í•œ ì†Œë…ì˜ í–¥" },
      { name: "ì¹´ëª¨ë§ˆì¼", category: "Herb", note: "M", tags: ["ìœ„ë¡œ", "í¬ìš©"], desc: "ì˜ˆë¯¼í•´ì§„ ì‹ ê²½ì„ 'ê´œì°®ì•„'ë¼ê³  ë‹¤ë…ì—¬ì£¼ëŠ” ë”°ëœ»í•œ ìœ„ë¡œê°€ í•„ìš”í•´ìš”.", scentDesc: "ë§ë¦° ì‚¬ê³¼ì™€ êµ­í™”ì°¨ì—ì„œ ë‚˜ëŠ” ì€ì€í•˜ê³  ë‹¬í°í•œ í–¥" },
      { name: "ì‹œíŠ¸ë¡œë„¬ë¼", category: "Herb", note: "T", tags: ["ê²½ê³„", "ë°©í–¥"], desc: "ë¶ˆí•„ìš”í•œ ê´€ê³„ë¥¼ ëŠì–´ë‚´ê³  ë‚˜ë§Œì˜ ê³µê°„ì„ í™•ì‹¤íˆ í™•ë³´í•˜ì„¸ìš”.", scentDesc: "ë²Œë ˆê°€ ì‹«ì–´í•  ë§Œí¼ ê°•ë ¬í•˜ê³  ë‚ ì¹´ë¡œìš´ í’€í–¥" },
      { name: "í™”ì´íŠ¸í‹°", category: "Herb", note: "M", tags: ["ì—¬ë°±", "ì‹¬í”Œ"], desc: "ë³µì¡í•œ ê±´ ì‹«ê³  ì •ê°ˆí•œ ìƒíƒœë¥¼ ì›í•˜ì‹œëŠ”êµ°ìš”. ë§ˆìŒì— ì—¬ë°±ì„ ì£¼ì„¸ìš”.", scentDesc: "ì´ìŠ¬ ë§ºíŒ ì°»ìì²˜ëŸ¼ ì€ì€í•˜ê³  ê¹¨ë—í•œ í–¥" },
      { name: "ìƒŒë‹¬ìš°ë“œ", category: "Woody", note: "B", tags: ["ëª…ìƒ", "ì² í•™"], desc: "ì†Œë€ìŠ¤ëŸ¬ìš´ ì„¸ìƒì—ì„œ ë²—ì–´ë‚˜ ë‚´ë©´ì˜ ì†Œë¦¬ì— ì§‘ì¤‘í•  ì‹œê°„ì´ì—ìš”.", scentDesc: "ì˜¤ë˜ëœ ì‚¬ì›ì—ì„œ ë‚  ë²•í•œ ê³ ìš”í•˜ê³  ë¬µì§í•œ ë‚˜ë¬´í–¥" },
      { name: "ì‹œë”ìš°ë“œ", category: "Woody", note: "B", tags: ["ë¿Œë¦¬", "ê¸°ë‘¥"], desc: "í”ë“¤ë¦¬ëŠ” ìƒí™© ì†ì—ì„œ ëŒ€ì§€ì²˜ëŸ¼ êµ³ê±´í•œ ë²„íŒ€ëª©ì´ ë˜ì–´ì£¼ì„¸ìš”.", scentDesc: "ì—°í•„ì‹¬ì—ì„œ ë‚˜ëŠ” ë“¯í•œ ê±´ì¡°í•˜ê³  ì”ì“¸í•œ ë‚˜ë¬´í–¥" },
      { name: "í”„ë‘í‚¨ì„¼ìŠ¤", category: "Woody", note: "B", tags: ["ì˜í˜¼", "ì„±ì°°"], desc: "í˜„ì‹¤ì˜ ê³ ë¯¼ì„ ë„˜ì–´ ì˜ì ì¸ í‰ì˜¨í•¨ê³¼ ì„±ì°°ì„ ì›í•˜ì‹œëŠ”êµ°ìš”.", scentDesc: "ì‹ ì„±í•œ ì˜ì‹ì— ì“°ì´ëŠ” ìŠ¤ëª¨í‚¤í•˜ê³  ì‹ ë¹„ë¡œìš´ ë‚˜ë¬´ì§„ì•¡ í–¥" },
      { name: "ë°”ë‹ë¼", category: "Earthy", note: "B", tags: ["ë‹¤ì •", "ì¶”ì–µ"], desc: "ë‹¤ì •í•œ ì†ê¸¸ì´ ê·¸ë¦¬ìš´ ë‚ , ë‹¬ì½¤í•œ ì¶”ì–µìœ¼ë¡œ ë§ˆìŒì„ ì±„ì›Œë³´ì„¸ìš”.", scentDesc: "ì•„ì´ìŠ¤í¬ë¦¼ì²˜ëŸ¼ ë¶€ë“œëŸ½ê³  ë‹¬ì½¤í•œ ë°”ë‹ë¼ë¹ˆ í–¥" },
  ];

  const CATEGORY_PERSONA = {
    "Floral": "ğŸ’ <strong>ê³µê° ëŠ¥ë ¥ 200% ê°ì„± ì²œì¬</strong><br>íƒ€ì¸ì˜ ê°ì •ì„ ëˆ„êµ¬ë³´ë‹¤ ì˜ ì´í•´í•˜ê³ , ë”°ëœ»í•œ ë§ í•œë§ˆë””ë¡œ ì‚¬ëŒì„ ì‚´ë¦¬ëŠ” ëŠ¥ë ¥ì´ ìˆìœ¼ì„¸ìš”. ë‹¹ì‹ ì€ ì‚¬ë‘ë°›ê¸° ìœ„í•´ íƒœì–´ë‚œ ì‚¬ëŒì´ì—ìš”.",
    "Citrus": "ğŸŠ <strong>ëŒ€ì²´ë¶ˆê°€! ì¸ê°„ ë¹„íƒ€ë¯¼</strong><br>ì–´ë””ì„œë“  ë¶„ìœ„ê¸°ë¥¼ ì£¼ë„í•˜ëŠ” ê¸°ì§ˆê³¼ ë‚™ì²œì ì¸ ë§ˆì¸ë“œë¥¼ ê°€ì§€ì…¨êµ°ìš”! ì‹¤íŒ¨í•´ë„ íˆ­ í„¸ê³  ì¼ì–´ë‚˜ëŠ” ë‹¹ì‹ ì˜ íšŒë³µíƒ„ë ¥ì„±ì€ ëª¨ë‘ì˜ ë¶€ëŸ¬ì›€ì„ ì‚¬ìš”.",
    "Herb": "ğŸŒ¿ <strong>ë‹´ë°±í•˜ê³  ì¿¨í•œ ë¯¸ë‹ˆë©€ë¦¬ìŠ¤íŠ¸</strong><br>ë³µì¡í•œ ê±´ ë”± ì§ˆìƒ‰ì´ì‹œêµ°ìš”! ë‚¨ë“¤ì˜ ì‹œì„ ë³´ë‹¤ëŠ” ë‚˜ë§Œì˜ í‰í™”ì™€ ì•ˆì •ì„ ì¤‘ìš”ì‹œí•˜ëŠ” ì£¼ê´€ ëšœë ·í•œ ëª¨ìŠµì´ ì •ë§ ë©‹ì ¸ìš”.",
    "Woody": "ğŸŒ² <strong>ì‹ ë¢°ë„ 1ìœ„, ë¦¬ë”í˜• ì¸ì¬</strong><br>ê°€ë²¼ìš´ ë§ë³´ë‹¤ëŠ” ë¬µì§í•œ í–‰ë™ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ë¶„ì´ì‹œêµ°ìš”. ì¹œêµ¬ë“¤ì´ ê³ ë¯¼ì´ ìˆì„ ë•Œ ê°€ì¥ ë¨¼ì € ì°¾ëŠ” ë©˜í†  ê°™ì€ ì¡´ì¬ì˜ˆìš”.",
    "Earthy": "ğŸ‚ <strong>ì • ë§ê³  ì† ê¹Šì€ 'ì§„êµ­'</strong><br>ì²«ì¸ìƒì€ ì¡°ìš©í•´ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, ì•Œë©´ ì•Œìˆ˜ë¡ ì§„êµ­ì¸ ë¶„ì´ì„¸ìš”. ë¬µë¬µíˆ ë‚´ ì‚¬ëŒì„ ì±™ê¸°ëŠ” ë‹¹ì‹ ì˜ ì˜ë¦¬ëŠ” ê·¸ ë¬´ì—‡ë³´ë‹¤ ê¹Šê³  ë‹¨ë‹¨í•´ìš”."
  };

  const OIL_QUESTIONS = [
      { 
        id: "pref", 
        q: "Q1. í‰ì†Œ ë‹¹ì‹ ì´ ê°€ì¥ ì¢‹ì•„í•˜ëŠ” í–¥ê¸°ëŠ”?", 
        options: [
          { text: "ì‹œíŠ¸ëŸ¬ìŠ¤", desc: "ì˜¤ë Œì§€, ë ˆëª¬, ë¼ì„", tag: "Citrus", img: "citrus.png" },
          { text: "í”Œë¡œëŸ´", desc: "ì¥ë¯¸, ë¼ë²¤ë”, ê½ƒí–¥ê¸°", tag: "Floral", img: "floral.png" },
          { text: "í—ˆë¸Œ/ê·¸ë¦°", desc: "í’€ë‚´ìŒ, ìœ ì¹¼ë¦½íˆ¬ìŠ¤", tag: "Herb", img: "herb.png" },
          { text: "ìš°ë””/ì–´ìŠ¤", desc: "ë‚˜ë¬´, í™, ìˆ² ëƒ„ìƒˆ", tag: "Woody", img: "woody.png" } 
        ]
      },
      { q: "Q2. ë‚¯ì„  ìˆ²ê¸¸ì„ ê±·ë‹¤ ë¬¸ë“ ê±¸ìŒì„ ë©ˆì·„ìŠµë‹ˆë‹¤.<br>ê·¸ê³³ì—ì„œ ë‹¹ì‹ ì€ ë¬´ì—‡ì„ ë³´ê³  ìˆë‚˜ìš”?", options: [
          { text: "ë‚˜ë¬´ ì‚¬ì´ë¡œ ìŸì•„ì§€ëŠ” ì°¬ë€í•œ í–‡ì‚´", tag: "í–‡ì‚´" },
          { text: "ì•„ë¬´ë„ ë°Ÿì§€ ì•Šì€ ê¹Šì€ í™ê³¼ ë‚˜ë¬´ë¿Œë¦¬", tag: "ë¿Œë¦¬" },
          { text: "ë°”ëŒì— í”ë“¤ë¦¬ëŠ” ì‘ì€ ì•¼ìƒí™” í•œ ì†¡ì´", tag: "í”Œë¡œëŸ´" },
          { text: "ì½”ëì„ ìŠ¤ì¹˜ëŠ” ì„œëŠ˜í•˜ê³  ë§‘ì€ ê³µê¸°", tag: "ì‹œì›" }
      ]},
      { q: "Q3. ì§€ê¸ˆ ë‚˜ì—ê²Œ ê°€ì¥ í•„ìš”í•œ 'ê³µê°„'ì˜ ëŠë‚Œì€?", options: [
          { text: "ëˆ„êµ¬ì—ê²Œë„ ë°©í•´ë°›ì§€ ì•ŠëŠ” ë™êµ´ ê°™ì€ ê³³", tag: "ì°¨ë¶„í•¨" },
          { text: "ì‚¬ëŒë“¤ì˜ ì†Œë¦¬ê°€ ë“¤ë¦¬ëŠ” ë°ì€ ì¹´í˜", tag: "ì›ƒìŒ" },
          { text: "ëª¨ë“  ê²ƒì´ ì œìë¦¬ì— ì •ë¦¬ëœ ê¹”ë”í•œ ì„œì¬", tag: "ì •ëˆ" },
          { text: "í­ì‹ í•œ ì´ë¶ˆì´ ìˆëŠ” ë‹¤ë½ë°©", tag: "í¬ê·¼" }
      ]},
      { q: "Q4. ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì„ ë•Œ ë‚˜ì˜ ë°˜ì‘ì€?", options: [
          { text: "ì†ìœ¼ë¡œ ê¾¹ ì°¸ìœ¼ë©° ì‚­íŒë‹¤", tag: "í•´ì†Œ" },
          { text: "ì˜ˆë¯¼í•´ì ¸ì„œ ë‚ ì¹´ë¡­ê²Œ ë°˜ì‘í•œë‹¤", tag: "ì•ˆì •" },
          { text: "ì•„ë¬´ê²ƒë„ í•˜ê¸° ì‹«ì–´ ë¬´ê¸°ë ¥í•´ì§„ë‹¤", tag: "í™œë ¥" },
          { text: "ë¨¸ë¦¬ê°€ ë³µì¡í•´ì ¸ ìƒê°ì´ ë©ˆì¶”ì§€ ì•ŠëŠ”ë‹¤", tag: "ëª…ìƒ" }
      ]},
      { q: "Q5. ì—¬í–‰ì§€ì—ì„œ ìš°ì—°íˆ ë°›ì€ ì„ ë¬¼,<br>ë¬´ì—‡ì´ì—ˆìœ¼ë©´ ì¢‹ê² ë‚˜ìš”?", options: [
          { text: "ì§€í˜œê°€ ë‹´ê¸´ ì±…", tag: "ê¹Šì´" },
          { text: "ìƒí¼í•œ ë§›ì´ í†¡ í„°ì§€ëŠ” ì—´ëŒ€ê³¼ì¼", tag: "ìê·¹" },
          { text: "í™”ë ¤í•˜ê³  í–¥ê¸°ë¡œìš´ ê½ƒë‹¤ë°œ", tag: "ì•„ë¦„ë‹¤ì›€" },
          { text: "ë§ˆìŒì„ ì”»ì–´ì¤„ ë§‘ì€ ì°¨ í•œ ì”", tag: "ì •í™”" }
      ]},
      { q: "Q6. ë‚´ì¼ ì•„ì¹¨ ëˆˆì„ ë–´ì„ ë•Œ,<br>ê°€ì¥ ë°”ë¼ëŠ” ë‚˜ì˜ ìƒíƒœëŠ”?", options: [
          { text: "ê±±ì • ì—†ì´ ë§ˆìŒì´ ê¹ƒí„¸ì²˜ëŸ¼ ê°€ë³ê¸°ë¥¼", tag: "ê°€ë²¼ì›€" },
          { text: "ë¬´ì—‡ì´ë“  í•  ìˆ˜ ìˆëŠ” ìì‹ ê°ì´ ë„˜ì¹˜ê¸°ë¥¼", tag: "ì„ ëª…" },
          { text: "ì„¸ìƒì´ ë”°ëœ»í•˜ê³  ì•ˆì „í•˜ê²Œ ëŠê»´ì§€ê¸°ë¥¼", tag: "ì‹ ë¢°" },
          { text: "ì–´ì œì™€ëŠ” ë‹¤ë¥¸ ìƒˆë¡œìš´ ë‚´ê°€ ë˜ì–´ìˆê¸°ë¥¼", tag: "ìƒˆë¡œì›€" }
      ]},
      { q: "Q7. ì¹œêµ¬ë“¤ê³¼ì˜ ëª¨ì„ì—ì„œ ë‚˜ëŠ” ì–´ë–¤ ëª¨ìŠµì¸ê°€ìš”?", options: [
          { text: "ë¶„ìœ„ê¸°ë¥¼ ì£¼ë„í•˜ê³  ì—ë„ˆì§€ë¥¼ ë°œì‚°í•œë‹¤", tag: "ë§¤í˜¹" },
          { text: "ìƒëŒ€ì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì£¼ë©° ë§ì¥êµ¬ì¹œë‹¤", tag: "ë‹¤ì •" },
          { text: "ì£¼ë³€ ì‚¬ëŒë“¤ì„ ì±™ê¸°ê³  ë³´ì‚´í•€ë‹¤", tag: "ìœ„ë¡œ" },
          { text: "ë¹¨ë¦¬ ì§‘ì— ê°€ì„œ ì‰¬ê³  ì‹¶ë‹¤ëŠ” ìƒê° ë¿", tag: "íœ´ì‹" }
      ]},
      { q: "Q8. ì§€ê¸ˆ ê°€ì¥ ëŒë¦¬ëŠ” 'ì§ˆê°'ì€?", options: [
          { text: "ê±°ì¹ ì§€ë§Œ ìì—°ìŠ¤ëŸ¬ìš´ ë‚˜ë¬´ê»ì§ˆ", tag: "ìš°ë””" },
          { text: "ë¶€ë“œëŸ½ê³  ë§¤ë„ëŸ¬ìš´ ì‹¤í¬", tag: "ê°ê°" },
          { text: "ê¹¨ë—í•˜ê³  ë°”ìŠ¤ë½ê±°ë¦¬ëŠ” ë¦°ë„¨", tag: "ì²­ê²°" },
          { text: "ë§ë‘ë§ë‘í•˜ê³  ë”°ëœ»í•œ ì†œ", tag: "ìˆœìˆ˜" }
      ]},
      { q: "Q9. ë‹¹ì‹ ì˜ ì¸ìƒì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê°€ì¹˜ëŠ”?", options: [
          { text: "í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ê· í˜•ê³¼ í‰í™”", tag: "ê· í˜•" },
          { text: "ëŠì„ì—†ì´ ì„±ì¥í•˜ê³  ë‚˜ì•„ê°€ëŠ” í˜", tag: "í¬ë§" },
          { text: "ë‚˜ë¥¼ ì§€í‚¤ëŠ” ë‹¨ë‹¨í•œ ë³´í˜¸ë§‰", tag: "ë°©ì–´" },
          { text: "ì˜í˜¼ì„ ìš¸ë¦¬ëŠ” ê¹Šì€ ê¹¨ë‹¬ìŒ", tag: "ì˜í˜¼" }
      ]}
  ];

  const state = {
    view: 'menu',
    oilStep: 0,
    oilTags: [],
    selectedRecipeOils: [],
    top5ResultOils: [],
    userPreference: null,
    isProcessing: false
  };

  const mainContent = document.getElementById("mainContent");
  const pageTitle = document.getElementById("pageTitle");
  const pageSub = document.getElementById("pageSub");
  const stepPill = document.getElementById("stepPill");
  const barFill = document.getElementById("barFill");

  function render() {
    barFill.style.width = '0%';
    state.isProcessing = false;

    if (state.view === 'menu') {
        setTitle("ì—ì„¼ì…œ ì˜¤ì¼ í…Œë¼í”¼", "ì›í•˜ëŠ” ë©”ë‰´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", "HOME");
        mainContent.innerHTML = `
        <div class="choices">
          <button class="choice" onclick="startOilQuiz()">
             <div style="font-weight:700; color:var(--primary); font-size:1.1rem; margin-bottom:4px;">1. ì—ì„¼ì…œì˜¤ì¼ ì·¨í–¥ ì°¾ê¸°</div>
             <div style="color:#666; font-size:0.9rem;">ë‚´ ë§ˆìŒ ê¹Šì€ ê³³ì´ ì›í•˜ëŠ” í–¥ì„ ì•Œì•„ë´…ë‹ˆë‹¤.</div>
          </button>
          <button class="choice" onclick="setView('oil_recipe_intro')">
             <div style="font-weight:700; color:var(--primary); font-size:1.1rem; margin-bottom:4px;">2. DIY ì•„ë¡œë§ˆ ë ˆì‹œí”¼</div>
             <div style="color:#666; font-size:0.9rem;">ì›í•˜ëŠ” í–¥ì„ ì¡°í•©í•´ ë‚˜ë§Œì˜ ë ˆì‹œí”¼ë¥¼ ë§Œë“­ë‹ˆë‹¤.</div>
          </button>
        </div>`;
    } 
    else if (state.view === 'oil_recipe_intro') {
      setTitle("DIY ì•„ë¡œë§ˆ ë ˆì‹œí”¼", "ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì˜¤ì¼ì„ ì„ íƒí•˜ì‹œê² ì–´ìš”?", "Selection");
      mainContent.innerHTML = `
        <div style="display:grid; gap:12px;">
            <button class="recipe-intro-btn" onclick="setView('oil_recipe_manual')">
                <strong>ğŸ–ï¸ ì§ì ‘ ëª¨ë“  ì˜¤ì¼ ì„ íƒí•˜ê¸°</strong>
                <span>ë‚´ê°€ ì›í•˜ëŠ” í–¥ 3ê°€ì§€ë¥¼<br>ììœ ë¡­ê²Œ ê³¨ë¼ ì¡°í•©í•©ë‹ˆë‹¤.</span>
            </button>
            <button class="recipe-intro-btn" onclick="checkAndGoAutoRecipe()">
                <strong>ğŸ¤– ê²°ê³¼ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì²œë°›ê¸°</strong>
                <span>ë‚˜ì˜ ì˜¤ì¼ í…ŒìŠ¤íŠ¸ ê²°ê³¼(Top 5)ë¥¼<br>ë°”íƒ•ìœ¼ë¡œ ì–´ìš¸ë¦¬ëŠ” í–¥ì„ ì¶”ì²œë°›ìŠµë‹ˆë‹¤.</span>
            </button>
        </div>
        <div class="nav"><button class="btn" onclick="setView('menu')">â† ì´ì „ìœ¼ë¡œ</button></div>
      `;
    }
    else if (state.view === 'quiz_oil') { renderOilQuiz(); }
    else if (state.view === 'oil_recipe_manual') { renderRecipeManual(); }
    else if (state.view === 'oil_recipe_auto') { renderRecipeAuto(); }
  }

  // --- OIL QUIZ ---
  window.startOilQuiz = () => {
    state.view = 'quiz_oil';
    state.oilStep = 0;
    state.oilTags = [];
    state.userPreference = null;
    render();
  };

  function renderOilQuiz() {
    const progress = (state.oilStep / OIL_QUESTIONS.length) * 100;
    setTimeout(() => { barFill.style.width = `${progress}%`; }, 50);
    
    if (state.oilStep >= OIL_QUESTIONS.length) { renderOilResult(); return; }
    
    const q = OIL_QUESTIONS[state.oilStep];
    const isPref = q.id === "pref";
    
    setTitle(isPref ? "ì·¨í–¥ íƒìƒ‰" : "ë‚´ë©´ íƒìƒ‰", 
             isPref ? "í‰ì†Œ ì„ í˜¸í•˜ëŠ” í–¥ê¸°ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”." : "ë‹¹ì‹ ì˜ ê°ê°ì„ ë”°ë¼ê°€ë³´ì„¸ìš”.", 
             `${state.oilStep+1} / ${OIL_QUESTIONS.length}`);
             
    let optionsHtml = '';
    
    if (isPref) {
      optionsHtml = `<div class="pref-grid">
        ${q.options.map((opt) => `
          <div class="pref-card" onclick="handleOptionClick(this, '${opt.tag}')">
            <img src="${opt.img}" class="pref-img" alt="${opt.text}">
            <div class="pref-name">${opt.text}</div>
            <div class="pref-desc">${opt.desc}</div>
          </div>
        `).join("")}
      </div>`;
    } else {
      optionsHtml = `<div class="choices">
        ${q.options.map((opt) => `<button class="choice" onclick="handleOptionClick(this, '${opt.tag}')">${opt.text}</button>`).join("")}
      </div>`;
    }

    mainContent.innerHTML = `
      <h2 class="q-title">${q.q}</h2>
      ${optionsHtml}
      <div class="nav"><button class="btn" onclick="prevOilStep()" ${state.oilStep===0 ? 'disabled':''}>ì´ì „</button><button class="btn danger" onclick="setView('menu')">ì·¨ì†Œ</button></div>`;
  }

  window.handleOptionClick = (element, tag) => {
    if (state.isProcessing) return;
    state.isProcessing = true;
    element.classList.add('clicked');
    setTimeout(() => { pickOilAnswer(tag); }, 150); 
  };

  window.pickOilAnswer = (tag) => {
    if (OIL_QUESTIONS[state.oilStep].id === "pref") { state.userPreference = tag; } 
    else { state.oilTags[state.oilStep] = tag; }
    state.oilStep++; render(); 
  };
  
  window.prevOilStep = () => { if (state.oilStep > 0) { state.oilStep--; render(); } };

  function renderOilResult() {
    let scoredOils = OIL_DATA.map(oil => {
        let score = oil.tags.filter(t => state.oilTags.includes(t)).length;
        return { ...oil, score: score + Math.random() * 0.5 }; 
    });
    scoredOils.sort((a, b) => b.score - a.score);
    const top5 = scoredOils.slice(0, 5);
    state.top5ResultOils = top5; 
    const bestOil = top5[0];

    const catCounts = {};
    top5.forEach(o => { catCounts[o.category] = (catCounts[o.category] || 0) + 1; });
    const topCat = Object.keys(catCounts).sort((a,b) => catCounts[b] - catCounts[a])[0];
    const personaMsg = CATEGORY_PERSONA[topCat] || "ë‹¤ì±„ë¡œìš´ ë§¤ë ¥ì„ ì§€ë‹Œ ì¡°í™”ë¡œìš´ ì‚¬ëŒ";
    const userPref = state.userPreference || "Floral";

    let analysisTitle = "", analysisDesc = "";
    const isMatch = userPref === topCat || (userPref === "Woody" && topCat === "Earthy") || (userPref === "Earthy" && topCat === "Woody");

    if (isMatch) {
        analysisTitle = "ğŸŒ¿ ë‚˜ë¥¼ ì‚¬ë‘í•˜ëŠ” ë§ˆìŒ, ê·¸ í‰ì˜¨í•œ ì¼ì¹˜";
        analysisDesc = `ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ ë§ˆìŒì„ ê°€ë§Œíˆ ë“¤ì—¬ë‹¤ë³´ë‹ˆ, ì°¸ í‰ì˜¨í•˜ê³  ë‹¨ë‹¨í•œ ìƒíƒœì´ì‹œêµ°ìš”.<br><br>í‰ì†Œ ì¢‹ì•„í•˜ì‹œë˜ <strong>[${userPref}]</strong> í–¥ê¸°ê°€ ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ ëª¸ê³¼ ë§ˆìŒì´ ì›í•˜ëŠ” ì—ë„ˆì§€ì™€ ì •í™•íˆ ë§ë‹¿ì•„ ìˆì–´ìš”.`;
    } else {
        analysisTitle = "ğŸ’Œ ë¯¸ì²˜ ëª°ëë˜ ë‚´ ë§ˆìŒì˜ ì‘ì€ ëª©ì†Œë¦¬";
        analysisDesc = `ì¡°ê¸ˆì€ ë‚¯ì„  ê²°ê³¼ì— ê³ ê°œë¥¼ ê°¸ìš°ëš±í•˜ì…¨ë‚˜ìš”? í‰ì†Œ ì¢‹ì•„í•˜ë˜ í–¥ê¸°ê°€ ë‹¹ì‹ ì˜ 'ë©‹ì§„ ëª¨ìŠµ'ì„ ëŒ€ë³€í–ˆë‹¤ë©´, ì˜¤ëŠ˜ ë°œê²¬ëœ ì´ í–¥ê¸°ëŠ” ë‹¹ì‹ ì˜ ë¬´ì˜ì‹ì´ ì¡°ì‹¬ìŠ¤ë ˆ ë³´ë‚´ì˜¨ <strong>'ì§„ì§œ ìœ„ë¡œ'</strong>ì˜ í¸ì§€ì˜ˆìš”.`;
    }

    let noteAdvice = "";
    if (bestOil.note === 'T') noteAdvice = `<br><br><strong>ğŸ’¡ Top Note ì²˜ë°©:</strong><br>"ì§€ê¸ˆ ë‹¹ì‹ ì˜ ì–´ê¹¨ê°€ ì¡°ê¸ˆ ë¬´ê±°ìš´ ê±´ ì•„ë‹Œê°€ìš”? ê°€ë²¼ìš´ ì „í™˜ì´ í•„ìš”í•œ ì‹œê¸°ì˜ˆìš”."`;
    else if (bestOil.note === 'M') noteAdvice = `<br><br><strong>ğŸ’¡ Middle Note ì²˜ë°©:</strong><br>"ëˆ„êµ°ê°€ì—ê²Œ ë‚´ì¤€ ë§ˆìŒë§Œí¼, ì •ì‘ ë‹¹ì‹ ì˜ ë§ˆìŒì€ ì¡°ê¸ˆ í—ˆì „í–ˆë‚˜ ë´ìš”."`;
    else if (bestOil.note === 'B') noteAdvice = `<br><br><strong>ğŸ’¡ Base Note ì²˜ë°©:</strong><br>"ì ì‹œ íœ˜ì²­ì—¬ë„ ê´œì°®ì•„ìš”. ëŒ€ì§€ì²˜ëŸ¼ êµ³ê±´í•œ ë²„íŒ€ëª©ì´ í•„ìš”í•´ìš”."`;

    barFill.style.width = '100%';
    setTitle("ìƒë‹´ ê²°ê³¼", "ë‹¹ì‹ ì˜ ë§ˆìŒì„ ì½ì–´ë³´ì•˜ìŠµë‹ˆë‹¤.", "ì™„ë£Œ");

    mainContent.innerHTML = `
      <section class="result-section">
        <div style="padding:10px 0;">
          <div style="display:flex; justify-content:center; gap:10px; margin-bottom:24px;">
            <div style="background:#f5f5f5; padding:8px 16px; border-radius:20px; font-size:13px; color:#6d4c41;">
              â¤ï¸ ì˜ì‹ì˜ í–¥: <strong>${userPref}</strong>
            </div>
            <div style="background:#e8f5e9; padding:8px 16px; border-radius:20px; font-size:13px; color:#2e7d32; border:1px solid #2e7d32;">
              ğŸ’Š ë¬´ì˜ì‹ì˜ í–¥: <strong>${topCat}</strong>
            </div>
          </div>
          <div class="analysis-box">
             <div class="analysis-title">${analysisTitle}</div>
             <div class="analysis-text">${analysisDesc}${noteAdvice}</div>
          </div>
          <div class="persona-card">
            <div class="persona-title">#${topCat} Type ì„±í–¥</div>
            <div class="persona-desc">${personaMsg}</div>
          </div>
          <div class="empathy-msg">"ì§€ê¸ˆì€, ${bestOil.desc}"</div>
          <div id="oil-list">
            ${top5.map((oil, idx) => `
              <div class="oil-card ${idx===0 ? 'best' : ''}">
                <div style="flex:1;">
                  <div style="font-size:${idx===0? '1.1rem':'1rem'}; margin-bottom:6px; ${idx===0?'color:var(--accent); font-weight:700;':''}">
                    ${idx+1}. ${oil.name}
                  </div>
                  <div class="scent-desc" style="font-size:0.9rem; color:#666; line-height:1.4;">${oil.scentDesc}</div>
                </div>
              </div>
            `).join("")}
          </div>
          <button class="wide-btn primary" onclick="checkAndGoAutoRecipe()">ğŸ§ª ì´ ì²˜ë°©ëŒ€ë¡œ ë¡¤ì˜¨ ë§Œë“¤ê¸°</button>
          <div style="text-align:center; font-family:var(--font-hand); font-size:1.4rem; margin:30px 0 10px; color:#888;">"ì´ í–¥ê¸°ë¥¼ ë§¡ìœ¼ë©°,<br>ì˜¤ëŠ˜ ê°€ì¥ í•˜ê³  ì‹¶ì€ ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?"</div>
        </div>
        <div style="display:flex; gap:6px; margin-top:20px;">
          <button class="btn capture" onclick="captureResult('app', '${bestOil.name}_ê²°ê³¼')">ğŸ“· ì €ì¥</button>
          <button class="btn primary" onclick="shareResult('${bestOil.name}')">ê³µìœ </button>
          <button class="btn" onclick="startOilQuiz()">ë‹¤ì‹œí•˜ê¸°</button>
          <button class="btn" onclick="setView('menu')">ë©”ë‰´</button>
        </div>
      </section>
    `;
  }

  // --- MANUAL RECIPE ---
  function renderRecipeManual() {
    setTitle("ë‚˜ë§Œì˜ ë ˆì‹œí”¼ (ì§ì ‘ ì„ íƒ)", "ì›í•˜ëŠ” ì˜¤ì¼ì„ ìµœëŒ€ 3ê°œ ì„ íƒí•˜ì„¸ìš”.", "Manual");
    const isBtnDisabled = state.selectedRecipeOils.length === 0;
    
    mainContent.innerHTML = `
      <div class="selection-grid">
        ${OIL_DATA.map(oil => {
            const isSelected = state.selectedRecipeOils.some(o => o.name === oil.name);
            return `<div class="oil-select-item ${isSelected ? 'selected' : ''}" onclick="toggleRecipeOil('${oil.name}')">${oil.name}</div>`;
        }).join('')}
      </div>
      <button id="recipeBtn" class="wide-btn primary" ${isBtnDisabled ? 'disabled' : ''} onclick="calcRecipe('manual')">ğŸŒ¿ ë ˆì‹œí”¼ ë„ì¶œí•˜ê¸°</button>
      <div id="recipeResult" style="display:none; margin-top:20px;"></div>
      <div class="nav"><button class="btn" onclick="setView('oil_recipe_intro')">ì´ì „ìœ¼ë¡œ</button></div>`;
  }

  // --- AUTO RECIPE ---
  function renderRecipeAuto() {
    setTitle("ë§ì¶¤ ë ˆì‹œí”¼ (ìë™ ì¶”ì²œ)", "ê²°ê³¼ ëª©ë¡ì—ì„œ 1~2ê°œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", "Auto");
    const selCount = state.selectedRecipeOils.length;
    let btnText = "ì˜¤ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”", isBtnDisabled = true;
    if (selCount === 1) { btnText = "ë‚˜ë¨¸ì§€ 2ê°œ ìë™ ì¶”ì²œë°›ê¸°"; isBtnDisabled = false; }
    else if (selCount === 2) { btnText = "ë‚˜ë¨¸ì§€ 1ê°œ ìë™ ì¶”ì²œë°›ê¸°"; isBtnDisabled = false; }
    else if (selCount >= 3) { btnText = "2ê°œê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤"; isBtnDisabled = true; }

    mainContent.innerHTML = `
      <div style="background:#FFF3E0; padding:12px; border-radius:12px; font-size:0.9rem; color:#EF6C00; margin-bottom:16px; text-align:center; word-break:keep-all;">
        ğŸ’¡ í…ŒìŠ¤íŠ¸ ê²°ê³¼(Top 5) ì¤‘ ê°€ì¥ ë§ˆìŒì— ë“œëŠ” ì˜¤ì¼ì„ 1~2ê°œë§Œ ê³¨ë¼ì£¼ì„¸ìš”. ë‚˜ë¨¸ì§€ëŠ” AIê°€ ì¡°í™”ë¡­ê²Œ ì±„ì›Œë“œë¦½ë‹ˆë‹¤.
      </div>
      <div class="selection-grid">
        ${state.top5ResultOils.map(oil => {
            const isSelected = state.selectedRecipeOils.some(o => o.name === oil.name);
            return `<div class="oil-select-item ${isSelected ? 'selected' : ''}" onclick="toggleAutoRecipeOil('${oil.name}')">
                <div style="font-size:10px; margin-bottom:2px; opacity:0.8; text-transform:uppercase;">${oil.category}</div>
                ${oil.name}
            </div>`;
        }).join('')}
      </div>
      <button id="autoRecipeBtn" class="wide-btn primary" ${isBtnDisabled ? 'disabled' : ''} onclick="runAutoRecommend()">âœ¨ ${btnText}</button>
      <div id="recipeResult" style="display:none; margin-top:20px;"></div>
      <div class="nav"><button class="btn" onclick="setView('oil_recipe_intro')">ì´ì „ìœ¼ë¡œ</button></div>`;
  }

  window.checkAndGoAutoRecipe = () => {
    if (!state.top5ResultOils || state.top5ResultOils.length === 0) {
        alert("ì´ì „ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.\në¨¼ì € '1. ì—ì„¼ì…œì˜¤ì¼ ì·¨í–¥ ì°¾ê¸°'ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”."); return;
    }
    state.selectedRecipeOils = []; setView('oil_recipe_auto');
  };
  window.toggleRecipeOil = (name) => {
    const oil = OIL_DATA.find(o => o.name === name);
    const idx = state.selectedRecipeOils.findIndex(o => o.name === name);
    if (idx > -1) { state.selectedRecipeOils.splice(idx, 1); }
    else { if (state.selectedRecipeOils.length >= 3) { alert("ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤."); return; } state.selectedRecipeOils.push(oil); }
    renderRecipeManual(); 
  };
  window.toggleAutoRecipeOil = (name) => {
    const oil = OIL_DATA.find(o => o.name === name);
    const idx = state.selectedRecipeOils.findIndex(o => o.name === name);
    if (idx > -1) { state.selectedRecipeOils.splice(idx, 1); }
    else { if (state.selectedRecipeOils.length >= 2) { alert("ìë™ ì¶”ì²œì„ ìœ„í•´ ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ ì„ íƒí•´ì£¼ì„¸ìš”."); return; } state.selectedRecipeOils.push(oil); }
    renderRecipeAuto(); 
  };
  window.runAutoRecommend = () => {
    const currentPicks = [...state.selectedRecipeOils];
    const targetCount = 3;
    const needed = targetCount - currentPicks.length;
    const currentNotes = currentPicks.map(o => o.note);
    const currentNames = currentPicks.map(o => o.name);
    let candidates = OIL_DATA.filter(o => !currentNames.includes(o.name));
    candidates.forEach(c => {
        c.tempScore = 0;
        if (!currentNotes.includes(c.note)) c.tempScore += 5; 
        const isSameCat = currentPicks.some(p => p.category === c.category);
        if (!isSameCat) c.tempScore += 2;
        c.tempScore += Math.random(); 
    });
    candidates.sort((a,b) => b.tempScore - a.tempScore);
    const recommendations = candidates.slice(0, needed);
    const finalOils = [...currentPicks, ...recommendations];
    displayRecipeResult(finalOils, recommendations.map(r => r.name));
  };
  window.calcRecipe = () => { displayRecipeResult(state.selectedRecipeOils, []); };
  function displayRecipeResult(oils, aiPickNames) {
    const resultDiv = document.getElementById('recipeResult');
    resultDiv.style.display = 'block';
    let distribution = oils.length === 1 ? [20] : (oils.length === 2 ? [12, 8] : [10, 6, 4]);
    let rows = oils.map((oil, idx) => {
        const isAi = aiPickNames.includes(oil.name);
        return `<div class="drop-row">
            <span>
                ${isAi ? '<span style="font-size:11px; background:var(--accent); color:#fff; padding:2px 6px; border-radius:4px; margin-right:4px;">AI</span>' : ''}
                ğŸ’§ ${oil.name} <span style="font-size:12px; color:#888;">(${oil.note} Note)</span>
            </span>
            <strong>${distribution[idx]} ë°©ìš¸</strong>
        </div>`;
    }).join('');
    resultDiv.innerHTML = `
      <div class="recipe-box"><h3 style="margin:0 0 15px; text-align:center; color:var(--primary);">ğŸ“‹ ë‚˜ë§Œì˜ ë¸”ë Œë”© (10ml ê¸°ì¤€)</h3>${rows}<div style="margin-top:15px; text-align:center; font-weight:bold; color:var(--accent); font-size:14px;">+ ìºë¦¬ì–´ ì˜¤ì¼(í˜¸í˜¸ë°” ë“±) 9ml ì±„ìš°ê¸°</div></div>
      <div style="margin-top:15px; display:flex; gap:10px;"><button class="btn capture" style="flex:1" onclick="captureResult('app', 'ë‚˜ë§Œì˜_ë ˆì‹œí”¼')">ğŸ“· ë ˆì‹œí”¼ ì €ì¥</button><button class="btn" style="flex:1" onclick="setView('menu')">ì²˜ìŒìœ¼ë¡œ</button></div>`;
      setTimeout(() => { resultDiv.scrollIntoView({ behavior: 'smooth' }); }, 100);
  }

  window.setView = (viewName) => { 
      state.view = viewName; 
      if (viewName === 'oil_recipe_manual') state.selectedRecipeOils = []; 
      render(); 
  };
  function setTitle(title, sub, pill) { pageTitle.textContent = title; pageSub.textContent = sub; stepPill.textContent = pill; }
  window.captureResult = (elementId, fileName) => {
    const element = document.getElementById(elementId);
    alert("ì´ë¯¸ì§€ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...");
    html2canvas(element, { backgroundColor: "#ffffff", scale: 2 }).then(canvas => {
        const link = document.createElement('a'); link.download = fileName + '.png'; link.href = canvas.toDataURL(); link.click();
    }).catch(err => { alert("ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); });
  };
  window.shareResult = (oilName) => {
    openShareModal();
  };
  window.closeShareModal = () => { document.getElementById('shareModal').classList.add('hidden'); };
  window.copyShareUrl = () => {
    const input = document.getElementById('shareUrlInput');
    input.select(); document.execCommand('copy');
    alert('ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
  };

    render();
})();

const REAL_URL = "https://wngml090256-sudo.github.io/wngml090256.github.io/oil.html";
window.openShareModal = async () => {
  const title = document.title;
  const input = document.getElementById('shareUrlInput');
  const qr = document.getElementById('qrImage');
  const modal = document.getElementById('shareModal');
  
  if(input) input.value = REAL_URL;
  if(qr) qr.src = `https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(REAL_URL)}`;
  
  if (navigator.share) { 
      try { 
          await navigator.share({ title: title, text: 'ë‚˜ì—ê²Œ ë§ëŠ” ìì—°ì˜ í–¥ê¸°ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.', url: REAL_URL }); 
      } catch (e) {}
      return; 
  } 
  if(modal) modal.classList.remove('hidden'); 
};
</script>
</body>
</html>