
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  
  <title>ì—ì„¼ì…œ ì˜¤ì¼ í…Œë¼í”¼ (Pro)</title>
  
  <!-- í°íŠ¸ ë¡œë“œ -->
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Pretendard:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root {
      --bg-color: #F9F7F2; 
      --card-bg: rgba(255, 255, 255, 0.96);
      --primary: #4A6C56; /* ì„¸ì´ì§€ ê·¸ë¦° */
      --primary-dark: #35503D;
      --accent: #D4A024; /* ê³¨ë“œ */
      --text-main: #2C2C2C;
      --text-sub: #555555;
      --border-radius: 20px;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      --font-main: 'Pretendard', sans-serif;
      --font-hand: 'Nanum Pen Script', cursive;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    body {
      /* ë°°ê²½ ì´ë¯¸ì§€ */
      background: url('https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?q=80&w=1200&auto=format&fit=crop') no-repeat center center fixed;
      background-size: cover;
      font-family: var(--font-main);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      min-height: 100vh;
      line-height: 1.5;
    }

    .wrap {
      width: 100%;
      max-width: 480px;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .card {
      background: var(--card-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 30px 24px;
      position: relative;
      overflow-y: auto;
      min-height: 85vh;
      max-height: 95vh;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }

    header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; flex-shrink: 0; }
    .header-left h1 { font-family: var(--font-hand); font-size: 2.2rem; color: var(--primary); margin-bottom: 4px; line-height: 1.1; }
    .sub { font-size: 0.9rem; color: var(--text-sub); font-weight: 400; }
    .icon-btn { background: rgba(0,0,0,0.05); border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }

    /* ì§„í–‰ë°” */
    .progress-area { margin-bottom: 24px; flex-shrink: 0; }
    .pill { display: inline-block; background: var(--primary); color: white; font-size: 0.75rem; padding: 4px 12px; border-radius: 20px; margin-bottom: 8px; font-weight: 600; }
    .bar { width: 100%; height: 6px; background: #EAEAEA; border-radius: 3px; overflow: hidden; }
    #barFill { height: 100%; background: var(--primary); width: 0%; transition: width 0.4s cubic-bezier(0.25, 1, 0.5, 1); }

    /* ë©”ì¸ ì½˜í…ì¸  */
    #mainContent { flex: 1; display: flex; flex-direction: column; animation: fadeIn 0.4s ease-out; overflow-y: auto; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* ë²„íŠ¼ë“¤ */
    .btn { padding: 14px 20px; border-radius: 12px; border: none; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.2s; background: #F0F0F0; color: var(--text-main); }
    .btn.primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(74, 108, 86, 0.3); }
    .btn.accent { background: var(--accent); color: white; }
    .btn.danger { background: #fff; border: 1px solid #ffcccc; color: #d32f2f; }
    .btn.capture { background: #333; color: #fff; }

    .choices { display: flex; flex-direction: column; gap: 12px; }
    .choice { background: #FFFFFF; border: 1px solid #EAEAEA; padding: 18px; border-radius: 16px; text-align: left; font-size: 1rem; color: var(--text-main); font-weight: 500; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
    .choice:hover { border-color: var(--primary); background: #F7FAF8; transform: translateY(-2px); }
    .choice.clicked { background: var(--primary); color: white; border-color: var(--primary); }

    /* ì·¨í–¥ ì´ë¯¸ì§€ ê·¸ë¦¬ë“œ (Q1 ì „ìš©) */
    .pref-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 10px; }
    .pref-card { background: #FFF; border: 1px solid #EAEAEA; border-radius: 16px; padding: 16px; text-align: center; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;}
    .pref-card:hover { border-color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.06); transform: translateY(-2px); }
    .pref-card.clicked { border-color: var(--primary); background: #EFF5F1; transform: scale(0.98); }
    
    /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ì¡°ì • (ì‚¬ìš©ìê°€ ì§€ì •í•œ íŒŒì¼ëª… ì‚¬ìš©) */
    .pref-img { 
        width: 100px;  /* ì´ë¯¸ì§€ í¬ê¸° ì‚´ì§ í‚¤ì›€ */
        height: 100px; 
        object-fit: contain; 
        margin-bottom: 12px; 
        filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05)); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
    }
    
    .pref-name { font-weight: 700; color: var(--text-main); }
    .pref-desc { font-size: 0.75rem; color: #888; margin-top: 4px; }
    
    .q-title { font-size: 1.35rem; font-weight: 700; margin-bottom: 24px; word-break: keep-all; color: var(--text-main); line-height: 1.4; }
    .nav { margin-top: auto; padding-top: 24px; display: flex; gap: 10px; flex-shrink: 0;}
    .nav .btn { flex: 1; }

    /* ê²°ê³¼ í˜ì´ì§€ */
    .result-section { background: rgba(255,255,255,0.5); border-radius: 16px; padding-bottom: 20px;}
    .analysis-box { background: #F7FAF8; border-radius: 16px; padding: 20px; margin-bottom: 20px; border-left: 4px solid var(--primary); }
    .analysis-title { font-weight: 700; font-size: 1.1rem; color: var(--primary); margin-bottom: 10px; }
    .analysis-text { font-size: 0.95rem; color: #555; line-height: 1.6; }
    
    /* ì˜¤ì¼ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ (ê°œì„ ë¨) */
    #oil-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 30px; }
    .oil-card { 
        display: flex; flex-direction: column; 
        background: #fff; border: 1px solid #eee; padding: 18px; 
        border-radius: 16px; transition: transform 0.2s; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.02);
    }
    .oil-card.best { 
        border: 2px solid var(--accent); background: #FFFEFA; 
        box-shadow: 0 4px 15px rgba(212, 160, 36, 0.15); 
        transform: scale(1.02); margin-bottom: 10px;
    }
    .oil-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .oil-name-txt { font-weight: 700; font-size: 1.05rem; color: var(--text-main); }
    .oil-desc-txt { font-size: 0.9rem; color: #666; line-height: 1.4; padding-left: 2px;}

    /* ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë¦¬ë“œ & ë ˆì‹œí”¼ */
    .category-group { margin-bottom: 24px; }
    .category-header { font-size: 0.95rem; font-weight: 700; color: var(--primary); margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 6px; display: flex; align-items: center; gap: 6px;}
    .selection-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
    
    .oil-select-item { background: #fff; border: 1px solid #eaeaea; border-radius: 12px; padding: 12px 4px; text-align: center; font-size: 0.85rem; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;}
    .oil-select-item.selected { background: var(--primary); color: white; border-color: var(--primary); }
    .warning-dot { position: absolute; top: 5px; right: 5px; width: 6px; height: 6px; background: #FF9800; border-radius: 50%; }

    .recipe-intro-btn { background: #fff; border: 1px solid #eaeaea; padding: 24px; border-radius: 16px; text-align: left; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
    .recipe-intro-btn:hover { border-color: var(--primary); transform: translateY(-3px); }
    .recipe-intro-btn strong { display: block; font-size: 1.1rem; margin-bottom: 6px; color: var(--text-main); }
    .recipe-intro-btn span { font-size: 0.9rem; color: #888; }

    .wide-btn { width: 100%; padding: 16px; border-radius: 14px; border: none; font-size: 1rem; margin-top: 10px; cursor: pointer; transition: 0.2s; }
    
    .drop-row { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px dashed #ddd; align-items: center; }
    .drop-row:last-child { border-bottom: none; }
    .recipe-box { background: #FFF; border: 2px dashed #AACCAE; padding: 20px; border-radius: 16px; margin-top: 20px;}
    .safety-alert { background: #FFF3E0; border: 1px solid #FFE0B2; color: #E65100; padding: 10px; border-radius: 8px; font-size: 0.85rem; margin-top: 10px; display: flex; align-items: center; gap: 8px;}

    .footer { margin-top: 40px; text-align: center; font-size: 0.75rem; color: #888; padding-bottom: 10px; }

  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">
      <header>
        <div class="header-left">
          <h1 id="pageTitle">ì—ì„¼ì…œ ì˜¤ì¼ í…Œë¼í”¼</h1>
          <div class="sub" id="pageSub">ë‚˜ë§Œì˜ í–¥ê¸°ë¥¼ ì°¾ì•„ ë– ë‚˜ëŠ” ì—¬í–‰</div>
        </div>
        <button class="icon-btn" onclick="location.href='index.html'">ğŸ </button>
      </header>
      
      <div class="progress-area">
          <div class="pill" id="stepPill">Home</div>
          <div class="bar"><div id="barFill"></div></div>
      </div>

      <main id="mainContent"></main>

      <div class="footer">
        <div>Â© ìì—°í™˜ê²½í•´ì„¤ì‚¬ ì •ì£¼í¬</div>
        <div>* 9ml ë¡¤ì˜¨ ìš©ê¸° ê¸°ì¤€ (í”¼ë¶€ ì•ˆì „ ë¹„ìœ¨ ì¤€ìˆ˜)</div>
      </div>
    </div>
  </div>

<script>
(() => {
  const OIL_DATA = [
      // Floral
      { name: "ë¼ë²¤ë”", category: "Floral", note: "M", isIrritant: false, tags: ["íœ´ì‹", "ìˆ˜ë©´", "ì•ˆì •", "ìœ„ë¡œ", "ì €ì—ë„ˆì§€"], desc: "ì§€ì¹œ í•˜ë£¨ ë, ì—„ë§ˆ í’ˆ ê°™ì€ ì˜¨ì „í•œ ì‰¼ì´ í•„ìš”í•´ìš”.", scentDesc: "ë³´ëë¹› ê½ƒë°­ì´ ë°”ëŒì— í©ë‚ ë¦¬ëŠ” ë“¯í•œ í¸ì•ˆí•œ í–¥" },
      { name: "ì¼ë‘ì¼ë‘", category: "Floral", note: "B", isIrritant: false, tags: ["ë§¤í˜¹", "ê°ê°", "ì‚¬ë‘", "í‘œí˜„", "ë‚­ë§Œ"], desc: "ì´ì„±ì´ ì•„ë‹Œ ë³¸ëŠ¥ê³¼ ê°ê°ì— ì†”ì§í•´ì§ˆ ì‹œê°„ì´ì—ìš”.", scentDesc: "ë‹¬ì½¤í•˜ê³  ë¬µì§í•˜ê²Œ í”¼ì–´ì˜¤ë¥´ëŠ” ê´€ëŠ¥ì ì¸ ê½ƒí–¥ê¸°" },
      { name: "ììŠ¤ë¯¼", category: "Floral", note: "B", isIrritant: false, tags: ["ìš°ì•„", "ì‹ ë¢°", "ìì¡´ê°", "ê¹Šì´", "ë°¤"], desc: "ë‹¹ì‹ ì€ ì´ë¯¸ ê³ ê·€í•œ ì‚¬ëŒì…ë‹ˆë‹¤. ìŠ¤ìŠ¤ë¡œë¥¼ ë” ë¯¿ì–´ì£¼ì„¸ìš”.", scentDesc: "ë‹¬ë¹› ì•„ë˜ í•€ í•˜ì–€ ê½ƒì²˜ëŸ¼ ê·¸ìœ½í•˜ê³  ê¹Šì€ í–¥" },
      { name: "ë¡œì¦ˆ", category: "Floral", note: "M", isIrritant: false, tags: ["ì‚¬ë‘", "í–‰ë³µ", "í¬ìš©", "ë”°ëœ»í•¨", "ì¹˜ìœ "], desc: "ë§ˆìŒì˜ ë¹ˆìë¦¬ë¥¼ ë”°ëœ»í•œ ì‚¬ë‘ìœ¼ë¡œ ì±„ì›Œë³´ì„¸ìš”.", scentDesc: "ìˆ˜ì²œ ì†¡ì´ ì¥ë¯¸ ê½ƒìì— íŒŒë¬»íŒ ë“¯í•œ í’ì„±í•œ í–¥" },
      { name: "ì œë¼ëŠ„", category: "Floral", note: "M", isIrritant: false, tags: ["ê· í˜•", "ì—¬ì„±", "ì¡°í™”", "íë¦„", "ì•ˆì •"], desc: "ê°ì •ì˜ ë¡¤ëŸ¬ì½”ìŠ¤í„° ì†ì—ì„œ í‰ì •ì‹¬ì„ ì°¾ê³  ì‹¶ìœ¼ì‹œêµ°ìš”.", scentDesc: "ì¥ë¯¸ì™€ í’€ë‚´ìŒì´ ì„ì¸ ë“¯í•œ ì‹±ê·¸ëŸ¬ìš´ ê½ƒí–¥ê¸°" },

      // Citrus (ìê·¹ì„± ì£¼ì˜)
      { name: "ë² ë¥´ê°€ëª»", category: "Citrus", note: "T", isIrritant: true, tags: ["ë°ìŒ", "í¬ë§", "í•´ì†Œ", "ìš°ìš¸", "ë¹›"], desc: "ê½‰ ë§‰íŒ ë§ˆìŒì„ í’€ì–´ì£¼ê³  í–‡ì‚´ ê°™ì€ í¬ë§ì„ ì±„ì›Œë³´ì„¸ìš”.", scentDesc: "í™ì°¨(ì–¼ê·¸ë ˆì´)ì— ë‹´ê¸´ ë“¯í•œ ê³ ê¸‰ìŠ¤ëŸ½ê³  ìŒ‰ìŒ€í•œ ê·¤í–¥" },
      { name: "ë ˆëª¬ê·¸ë¼ìŠ¤", category: "Citrus", note: "T", isIrritant: true, tags: ["í™œë ¥", "ìê·¹", "ë„ì „", "ìŠ¤í¬ì¸ ", "ì‹œì‘"], desc: "ë¬´ê¸°ë ¥í•¨ì„ ê¹¨ì›Œì¤„ ì•¼ìƒì˜ ê°•í•œ ìƒëª…ë ¥ì´ í•„ìš”í•´ìš”.", scentDesc: "í™ë‚´ìŒì´ ì„ì¸ ê±°ì¹ ê³  ê°•ë ¬í•œ ë ˆëª¬ í’€í–¥" },
      { name: "ìŠ¤ìœ„íŠ¸ì˜¤ë Œì§€", category: "Citrus", note: "T", isIrritant: false, tags: ["ì›ƒìŒ", "ì²œì§„", "ì¹œêµ¬", "ëŒ€í™”", "ì¦ê±°ì›€"], desc: "ê±±ì •ì€ ë‚´ë ¤ë†“ê³  ì•„ì´ì²˜ëŸ¼ í•´ë§‘ê²Œ ì›ƒê³  ì‹¶ì€ ë‚ ì´êµ°ìš”.", scentDesc: "ê»ì§ˆì„ ë§‰ ê¹ ì„ ë•Œ í¼ì§€ëŠ” ë‹¬ì½¤í•˜ê³  ìƒí¼í•œ ê³¼ì¦™í–¥" },
      { name: "ë ˆëª¬", category: "Citrus", note: "T", isIrritant: true, tags: ["ìƒì¾Œ", "ì§‘ì¤‘", "ëª…ë£Œ", "ê³µë¶€", "ì „í™˜"], desc: "ë³µì¡í•œ ë¨¸ë¦¿ì†ì„ ë¹„ìš°ê³  ë§‘ì€ ì •ì‹ ìœ¼ë¡œ ë¦¬ì…‹í•˜ì„¸ìš”.", scentDesc: "ì •ì‹ ì´ ë²ˆì© ë“¤ ë§Œí¼ ì‹œê³  ìƒì¾Œí•œ ë…¸ë€ìƒ‰ í–¥ê¸°" },
      { name: "ë¼ì„", category: "Citrus", note: "T", isIrritant: true, tags: ["ì¬ì¹˜", "ê°€ë²¼ì›€", "ìœ ì¾Œ", "íƒ„ì‚°", "ê¸°ë¶„"], desc: "ì‚¶ì´ ë„ˆë¬´ ë¬´ê²ë‚˜ìš”? í†¡ ì˜ëŠ” íƒ„ì‚°ìˆ˜ì²˜ëŸ¼ ê°€ë³ê²Œ ì¦ê²¨ìš”.", scentDesc: "ì…ì•ˆì— ì¹¨ì´ ê³ ì´ê²Œ í•˜ëŠ” ì¨í•˜ê³  ìŒ‰ì‹¸ë¦„í•œ ë¼ì„í–¥" },

      // Herb
      { name: "ë¡œì¦ˆë§ˆë¦¬", category: "Herb", note: "T", isIrritant: false, tags: ["ê¸°ì–µ", "ì„ ëª…", "ê°ì„±", "ê³µë¶€", "ë‘ë‡Œ"], desc: "ì•ˆê°œë¥¼ ê±·ì–´ë‚´ê³  ì •ì‹ ì„ ë§‘ê³  ë˜ë ·í•˜ê²Œ ê¹¨ì›Œë³´ì„¸ìš”.", scentDesc: "ë¨¸ë¦¬ê°€ ë§‘ì•„ì§€ëŠ” í†¡ ì˜ëŠ” í‘¸ë¥¸ í—ˆë¸Œì˜ í–¥" },
      { name: "ìœ ì¹¼ë¦½íˆ¬ìŠ¤", category: "Herb", note: "T", isIrritant: false, tags: ["ì •í™”", "ì‹œì›", "í˜¸í¡", "ë°”ëŒ", "ììœ "], desc: "ë‹µë‹µí•œ ìƒí™©ì— ê°‡íŒ ê¸°ë¶„ì¸ê°€ìš”? ì‹œì›í•œ ë°”ëŒì´ í•„ìš”í•´ìš”.", scentDesc: "ì½”ê°€ ë»¥ ëš«ë¦¬ëŠ” ë“¯í•œ ì‹œì›í•˜ê³  ì²­ëŸ‰í•œ ìˆ²ì˜ í–¥" },
      { name: "í˜í¼ë¯¼íŠ¸", category: "Herb", note: "T", isIrritant: true, tags: ["ì¶©ê²©", "ê¹¨ì–´ë‚¨", "ëƒ‰ì² ", "í†µì¦", "ë³€í™”"], desc: "ë‚˜íƒœí•´ì§„ ì •ì‹ ì— ì°¬ë¬¼ ê°™ì€ ìê·¹ê³¼ ìƒˆë¡œìš´ ì—ë„ˆì§€ë¥¼!", scentDesc: "ë°•í•˜ì‚¬íƒ•ì²˜ëŸ¼ í™”í•˜ê³  ì°¨ê°€ìš´ ë©˜í†¨ì˜ í–¥" },
      { name: "í‹°íŠ¸ë¦¬", category: "Herb", note: "T", isIrritant: true, tags: ["ë°©ì–´", "ì²­ê²°", "ë³´í˜¸", "ë©´ì—­", "ê¹”ë”"], desc: "ì™¸ë¶€ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œë¶€í„° ë‚˜ë¥¼ ì§€í‚¬ ë‹¨ë‹¨í•œ ë°©íŒ¨ê°€ í•„ìš”í•´ìš”.", scentDesc: "ì•½ì´ˆì²˜ëŸ¼ ìŒ‰ì‹¸ë¦„í•˜ê³  ê¹¨ë—í•œ ì†Œë…ì˜ í–¥" },
      
      // Woody / Earthy
      { name: "ìƒŒë‹¬ìš°ë“œ", category: "Woody", note: "B", isIrritant: false, tags: ["ëª…ìƒ", "ì² í•™", "ë‚´ë©´", "ê³ ìš”", "ì ˆ"], desc: "ì†Œë€ìŠ¤ëŸ¬ìš´ ì„¸ìƒì—ì„œ ë²—ì–´ë‚˜ ë‚´ë©´ì˜ ì†Œë¦¬ì— ì§‘ì¤‘í•  ì‹œê°„.", scentDesc: "ì˜¤ë˜ëœ ì‚¬ì›ì—ì„œ ë‚  ë²•í•œ ê³ ìš”í•˜ê³  ë¬µì§í•œ ë‚˜ë¬´í–¥" },
      { name: "ì‹œë”ìš°ë“œ", category: "Woody", note: "B", isIrritant: false, tags: ["ë¿Œë¦¬", "ê¸°ë‘¥", "ì˜ì§€", "ì„±ê³µ", "ë‚¨ì„±"], desc: "í”ë“¤ë¦¬ëŠ” ìƒí™© ì†ì—ì„œ ëŒ€ì§€ì²˜ëŸ¼ êµ³ê±´í•œ ë²„íŒ€ëª©ì´ ë˜ì–´ì£¼ì„¸ìš”.", scentDesc: "ì—°í•„ì‹¬ì—ì„œ ë‚˜ëŠ” ë“¯í•œ ê±´ì¡°í•˜ê³  ì”ì“¸í•œ ë‚˜ë¬´í–¥" },
      { name: "í”„ë‘í‚¨ì„¼ìŠ¤", category: "Woody", note: "B", isIrritant: false, tags: ["ì˜í˜¼", "ì„±ì°°", "ì‹ ì„±", "ê¸°ë„", "ì¹˜ìœ "], desc: "í˜„ì‹¤ì˜ ê³ ë¯¼ì„ ë„˜ì–´ ì˜ì ì¸ í‰ì˜¨í•¨ê³¼ ê¹Šì€ ì„±ì°°ì„ ì›í•˜ì‹œëŠ”êµ°ìš”.", scentDesc: "ì‹ ì„±í•œ ì˜ì‹ì— ì“°ì´ëŠ” ìŠ¤ëª¨í‚¤í•˜ê³  ì‹ ë¹„ë¡œìš´ ë‚˜ë¬´ì§„ì•¡ í–¥" },
      { name: "ë°”ë‹ë¼", category: "Earthy", note: "B", isIrritant: false, tags: ["ë‹¤ì •", "ì¶”ì–µ", "ìŒì‹", "í¬ë§Œ", "ë‹¬ì½¤"], desc: "ë‹¤ì •í•œ ì†ê¸¸ì´ ê·¸ë¦¬ìš´ ë‚ , ë‹¬ì½¤í•œ ì¶”ì–µìœ¼ë¡œ ë§ˆìŒì„ ì±„ì›Œë³´ì„¸ìš”.", scentDesc: "ì•„ì´ìŠ¤í¬ë¦¼ì²˜ëŸ¼ ë¶€ë“œëŸ½ê³  ë‹¬ì½¤í•œ ë°”ë‹ë¼ë¹ˆ í–¥" },
  ];

  const CATEGORY_ORDER = ["Floral", "Citrus", "Herb", "Woody"];
  const CATEGORY_NAMES = { "Floral": "ğŸ’ í”Œë¡œëŸ´ (ê½ƒ)", "Citrus": "ğŸŠ ì‹œíŠ¸ëŸ¬ìŠ¤ (ê³¼ì¼)", "Herb": "ğŸŒ¿ í—ˆë¸Œ/ê·¸ë¦°", "Woody": "ğŸŒ² ìš°ë””/ì–´ìŠ¤ (ë‚˜ë¬´)" };

  // â˜… ìˆ˜ì •ëœ ì§ˆë¬¸ ë°°ì—´ (ì´ë¯¸ì§€ íŒŒì¼ëª… ì ìš©) â˜…
  const OIL_QUESTIONS = [
      { 
        id: "pref", 
        q: "Q1. í‰ì†Œ ë‹¹ì‹ ì´ ê°€ì¥ ì¢‹ì•„í•˜ëŠ”<br>í–¥ê¸° ìŠ¤íƒ€ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?", 
        options: [
          { text: "ìƒí¼í•œ ì‹œíŠ¸ëŸ¬ìŠ¤", tag: "Citrus", img: "citrus.png" }, // íŒŒì¼ëª… ìˆ˜ì •ë¨
          { text: "í™”ì‚¬í•œ í”Œë¡œëŸ´", tag: "Floral", img: "floral.png" }, // íŒŒì¼ëª… ìˆ˜ì •ë¨
          { text: "ì‹±ê·¸ëŸ¬ìš´ í—ˆë¸Œ", tag: "Herb", img: "herb.png" },    // íŒŒì¼ëª… ìˆ˜ì •ë¨
          { text: "ê·¸ìœ½í•œ ìš°ë””", tag: "Woody", img: "woody.png" }   // íŒŒì¼ëª… ìˆ˜ì •ë¨
        ]
      },
      { 
        q: "Q2. ì§€ê¸ˆ ë‹¹ì‹ ì˜ ì—ë„ˆì§€ ìƒíƒœëŠ” ì–´ë–¤ê°€ìš”?", 
        options: [
          { text: "ë°©ì „ ì§ì „.. ì¶©ì „ê³¼ íœ´ì‹ì´ í•„ìš”í•´ìš”", tags: ["íœ´ì‹", "ìˆ˜ë©´", "ìœ„ë¡œ"] },
          { text: "ë‚˜ì˜ì§€ ì•Šì§€ë§Œ ì¡°ê¸ˆ ë” í™œë ¥ì´ í•„ìš”í•´ìš”", tags: ["í™œë ¥", "ì‹œì‘", "ìƒì¾Œ"] },
          { text: "ë„ˆë¬´ ë“¤ëœ¨ê³  ì‚°ë§Œí•´ì„œ ì°¨ë¶„í•´ì§€ê³  ì‹¶ì–´ìš”", tags: ["ì•ˆì •", "ê· í˜•", "ëª…ìƒ"] },
          { text: "ê°€ë¼ì•‰ì€ ê¸°ë¶„ì„ ë°ê²Œ ëŒì–´ì˜¬ë¦¬ê³  ì‹¶ì–´ìš”", tags: ["ë°ìŒ", "í¬ë§", "ì›ƒìŒ"] }
        ]
      },
      { 
        q: "Q3. í˜„ì¬ ê°€ì¥ í° ìŠ¤íŠ¸ë ˆìŠ¤ ì›ì¸ì€?", 
        options: [
          { text: "ì¸ê°„ê´€ê³„ì—ì„œ ì˜¤ëŠ” ê°ì • ì†Œëª¨", tags: ["ë°©ì–´", "ì‚¬ë‘", "ìì¡´ê°"] },
          { text: "ê³¼ë„í•œ ì—…ë¬´/í•™ì—…ìœ¼ë¡œ ì¸í•œ ë‘ë‡Œ í”¼ë¡œ", tags: ["ëª…ë£Œ", "íœ´ì‹", "ê¸°ì–µ"] },
          { text: "ë¯¸ë˜ì— ëŒ€í•œ ë§‰ë§‰í•¨ê³¼ ë¶ˆì•ˆ", tags: ["ë¿Œë¦¬", "ì‹ ë¢°", "ìš©ê¸°"] },
          { text: "ë°˜ë³µë˜ëŠ” ì§€ë£¨í•œ ì¼ìƒ", tags: ["ìê·¹", "ì¬ì¹˜", "ë§¤í˜¹"] }
        ]
      },
      { 
        q: "Q4. ì„ í˜¸í•˜ëŠ” 'ê³µê°„ì˜ ë¶„ìœ„ê¸°'ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”.", 
        options: [
          { text: "í–‡ì‚´ì´ ìŸì•„ì§€ëŠ” ë”°ëœ»í•œ ì •ì›", tags: ["í–‰ë³µ", "ë”°ëœ»í•¨", "ì²œì§„"] },
          { text: "ìƒˆë²½ ê³µê¸°ì²˜ëŸ¼ ì°¨ê°‘ê³  ê¹¨ë—í•œ ìˆ²", tags: ["ì •í™”", "ì‹œì›", "ê³ ë…"] },
          { text: "ì´›ë¶ˆì´ ì¼œì§„ ì•„ëŠ‘í•˜ê³  ì–´ë‘ìš´ ë°©", tags: ["ë‚´ë©´", "ì•ˆì‹", "ê¹Šì´"] },
          { text: "ì˜ ì •ëˆëœ ë¯¸ë‹ˆë©€í•œ ì„œì¬", tags: ["ì²­ê²°", "ì§‘ì¤‘", "ì² í•™"] }
        ]
      },
      { 
        q: "Q5. ë§ˆìŒì„ ì¹˜ìœ í•˜ëŠ” ë‹¹ì‹ ë§Œì˜ ë°©ì‹ì€?", 
        options: [
          { text: "ë§›ìˆëŠ” ê±¸ ë¨¹ê±°ë‚˜ í–¥ê¸°ë¥¼ ë§¡ìœ¼ë©° ê°ê° ì¶©ì¡±", tags: ["ê°ê°", "ë‹¬ì½¤", "ë§Œì¡±"] },
          { text: "ì¹œí•œ ì¹œêµ¬ë“¤ê³¼ ìˆ˜ë‹¤ ë–¨ë©° í„¸ì–´ë‚´ê¸°", tags: ["í‘œí˜„", "ì¹œêµ¬", "ì¦ê±°ì›€"] },
          { text: "í˜¼ì ì¡°ìš©íˆ ì¼ê¸°ë¥¼ ì“°ê±°ë‚˜ ë© ë•Œë¦¬ê¸°", tags: ["ì„±ì°°", "ì—¬ë°±", "ê³ ìš”"] },
          { text: "ë•€ í˜ë¦¬ë©° ìš´ë™í•˜ê±°ë‚˜ ëª¸ì„ ì›€ì§ì´ê¸°", tags: ["ë„ì „", "ìŠ¤í¬ì¸ ", "í•´ì†Œ"] }
        ]
      },
      { 
        q: "Q6. ì§€ê¸ˆ ê°€ì¥ ê°–ê³  ì‹¶ì€ 'ë§ˆìŒì˜ ëŠ¥ë ¥'ì€?", 
        options: [
          { text: "í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ë‹¨ë‹¨í•œ ë©˜íƒˆ", tags: ["ê¸°ë‘¥", "ë³´í˜¸", "ì˜ì§€"] },
          { text: "ëˆ„êµ¬ì—ê²Œë‚˜ ì‚¬ë‘ë°›ëŠ” ë§¤ë ¥", tags: ["ìš°ì•„", "ë§¤í˜¹", "ì—¬ì„±"] },
          { text: "ë³µì¡í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì˜ˆë¦¬í•¨", tags: ["ëƒ‰ì² ", "ì„ ëª…", "í†µì°°"] },
          { text: "ì‹¤íŒ¨ë¥¼ ë‘ë ¤ì›Œí•˜ì§€ ì•ŠëŠ” ê¸ì •", tags: ["í¬ë§", "ê°€ë²¼ì›€", "ìœ ì¾Œ"] }
        ]
      },
      { 
        q: "Q7. ë§ˆì§€ë§‰ìœ¼ë¡œ, ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ì–´ë–¤ ë‹¨ì–´ë¡œ ë§ˆë¬´ë¦¬í•˜ê³  ì‹¶ë‚˜ìš”?", 
        options: [
          { text: "í‰ì˜¨í•¨ (Peace)", tags: ["í‰ì˜¨", "ì•ˆì •", "ìˆœìˆ˜"] },
          { text: "ì„±ì·¨ê° (Achievement)", tags: ["ì„±ê³µ", "ë³€í™”", "í™•ì‹ "] },
          { text: "ì‚¬ë‘ (Love)", tags: ["í¬ìš©", "ë‹¤ì •", "ë‚­ë§Œ"] },
          { text: "ìƒì¾Œí•¨ (Fresh)", tags: ["ì •í™”", "ììœ ", "ë°”ëŒ"] }
        ]
      }
  ];

  const state = { view: 'menu', oilStep: 0, oilTags: [], selectedRecipeOils: [], top5ResultOils: [], userPreference: null, isProcessing: false };
  const mainContent = document.getElementById("mainContent");
  const pageTitle = document.getElementById("pageTitle");
  const stepPill = document.getElementById("stepPill");
  const barFill = document.getElementById("barFill");

  function render() {
    barFill.style.width = '0%'; state.isProcessing = false;
    
    // --- HOME ---
    if (state.view === 'menu') {
        setTitle("ì—ì„¼ì…œ ì˜¤ì¼ í…Œë¼í”¼", "HOME");
        mainContent.innerHTML = `
        <div class="choices">
          <button class="choice" onclick="startOilQuiz()">
             <div style="font-weight:700; color:var(--primary); font-size:1.1rem; margin-bottom:4px;">1. ì„±í–¥ ë¶„ì„ í…ŒìŠ¤íŠ¸</div>
             <div style="color:#666; font-size:0.9rem;">7ê°€ì§€ ì§ˆë¬¸ìœ¼ë¡œ ì•Œì•„ë³´ëŠ” ë‚˜ë§Œì˜ ì˜¤ì¼</div>
          </button>
          <button class="choice" onclick="setView('oil_recipe_intro')">
             <div style="font-weight:700; color:var(--primary); font-size:1.1rem; margin-bottom:4px;">2. DIY ë ˆì‹œí”¼ ì œì‘</div>
             <div style="color:#666; font-size:0.9rem;">ì›í•˜ëŠ” í–¥ì„ ì¡°í•©í•´ 9ml ë ˆì‹œí”¼ ë§Œë“¤ê¸°</div>
          </button>
        </div>`;
    } 
    // --- RECIPE INTRO ---
    else if (state.view === 'oil_recipe_intro') {
      setTitle("DIY ë ˆì‹œí”¼ ì œì‘", "Recipe");
      mainContent.innerHTML = `
        <div style="display:grid; gap:12px;">
            <button class="recipe-intro-btn" onclick="setView('oil_recipe_manual')">
                <strong>ğŸ–ï¸ ì§ì ‘ ê³ ë¥´ê¸°</strong>
                <span>ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì›í•˜ëŠ” ì˜¤ì¼ì„<br>ììœ ë¡­ê²Œ ì„ íƒí•©ë‹ˆë‹¤.</span>
            </button>
            <button class="recipe-intro-btn" onclick="checkAndGoAutoRecipe()">
                <strong>ğŸ¤– ê²°ê³¼ ê¸°ë°˜ ì¶”ì²œ</strong>
                <span>í…ŒìŠ¤íŠ¸ ê²°ê³¼(Top 5)ë¥¼ ë°”íƒ•ìœ¼ë¡œ<br>AIê°€ ì¡°í™”ë¡­ê²Œ ì¶”ì²œí•©ë‹ˆë‹¤.</span>
            </button>
        </div>
        <div class="nav"><button class="btn" onclick="setView('menu')">ë©”ë‰´ë¡œ</button></div>`;
    }
    else if (state.view === 'quiz_oil') { renderOilQuiz(); }
    else if (state.view === 'oil_recipe_manual') { renderRecipeManual(); }
    else if (state.view === 'oil_recipe_auto') { renderRecipeAuto(); }
  }

  // --- QUIZ ---
  window.startOilQuiz = () => { state.view = 'quiz_oil'; state.oilStep = 0; state.oilTags = []; render(); };
  
  function renderOilQuiz() {
    const progress = (state.oilStep / OIL_QUESTIONS.length) * 100;
    setTimeout(() => { barFill.style.width = `${progress}%`; }, 50);
    if (state.oilStep >= OIL_QUESTIONS.length) { renderOilResult(); return; }
    
    const q = OIL_QUESTIONS[state.oilStep];
    setTitle(`ì§ˆë¬¸ ${state.oilStep+1} / 7`, "Test");
    
    let html = `<h2 class="q-title">${q.q}</h2>`;
    
    if (q.id === "pref") {
      // Q1: ì´ë¯¸ì§€ ê·¸ë¦¬ë“œ
      html += `<div class="pref-grid">${q.options.map(opt => `
        <div class="pref-card" onclick="handleOption(this,'${opt.tag}')">
            <img src="${opt.img}" class="pref-img">
            <div class="pref-name">${opt.text}</div>
        </div>`).join("")}</div>`;
    } else {
      // Q2~Q7: í…ìŠ¤íŠ¸ ë²„íŠ¼
      html += `<div class="choices">${q.options.map(opt => {
          const tagStr = Array.isArray(opt.tags) ? opt.tags.join(',') : opt.tag;
          return `<button class="choice" onclick="handleOption(this,'${tagStr}')">${opt.text}</button>`;
      }).join("")}</div>`;
    }
    
    html += `<div class="nav"><button class="btn danger" onclick="setView('menu')">ì·¨ì†Œ</button></div>`;
    mainContent.innerHTML = html;
  }

  window.handleOption = (el, tagData) => {
    if(state.isProcessing) return; state.isProcessing = true;
    el.classList.add('clicked');
    
    if(OIL_QUESTIONS[state.oilStep].id === "pref") {
        state.userPreference = tagData;
    } else {
        const tags = tagData.split(',');
        state.oilTags.push(...tags);
    }
    
    state.oilStep++; setTimeout(render, 200);
  };

  function renderOilResult() {
    barFill.style.width = '100%'; setTitle("ë¶„ì„ ê²°ê³¼", "Result");
    
    let scored = OIL_DATA.map(o => {
        let score = 0;
        score += o.tags.filter(t => state.oilTags.includes(t)).length * 2;
        if (o.category === state.userPreference) score += 3;
        score += Math.random();
        return { ...o, score };
    });
    
    scored.sort((a,b)=>b.score - a.score);
    state.top5ResultOils = scored.slice(0,5);
    const best = state.top5ResultOils[0];
    
    mainContent.innerHTML = `
      <section class="result-section">
        <div class="analysis-box">
             <div class="analysis-title">ë‹¹ì‹ ì„ ìœ„í•œ ì²˜ë°©: ${best.name}</div>
             <div class="analysis-text">${best.desc}<br><br><strong>Note:</strong> ${best.note} Note</div>
        </div>
        <div id="oil-list">
            ${state.top5ResultOils.map((oil,i) => `
              <div class="oil-card ${i===0?'best':''}">
                  <div class="oil-header">
                      <span class="oil-name-txt">${i+1}. ${oil.name}</span>
                      ${i===0 ? '<span style="font-size:0.75rem; color:#D4A024; border:1px solid #D4A024; padding:2px 6px; border-radius:10px;">BEST</span>' : ''}
                  </div>
                  <div class="oil-desc-txt">${oil.scentDesc}</div>
              </div>
            `).join('')}
        </div>
        <button class="wide-btn primary" onclick="checkAndGoAutoRecipe()">ğŸ§ª ì´ ì˜¤ì¼ë“¤ë¡œ ë ˆì‹œí”¼ ë§Œë“¤ê¸°</button>
        <div class="nav"><button class="btn" onclick="setView('menu')">ë©”ë‰´</button></div>
      </section>`;
  }

  // --- MANUAL RECIPE ---
  function renderRecipeManual() {
    setTitle("ì˜¤ì¼ ì„ íƒ (ìµœëŒ€ 3ê°œ)", "Selection");
    
    let groupedHtml = "";
    CATEGORY_ORDER.forEach(cat => {
        const oils = OIL_DATA.filter(o => o.category === cat);
        if(oils.length > 0) {
            groupedHtml += `
            <div class="category-group">
                <div class="category-header">${CATEGORY_NAMES[cat]}</div>
                <div class="selection-grid">
                    ${oils.map(oil => {
                        const isSelected = state.selectedRecipeOils.some(o => o.name === oil.name);
                        return `<div class="oil-select-item ${isSelected ? 'selected' : ''}" onclick="toggleRecipeOil('${oil.name}')">
                            ${oil.name}
                            ${oil.isIrritant ? '<span class="warning-dot" title="í”¼ë¶€ ìê·¹ ì£¼ì˜"></span>' : ''}
                        </div>`;
                    }).join('')}
                </div>
            </div>`;
        }
    });

    const isBtnDisabled = state.selectedRecipeOils.length === 0;
    
    mainContent.innerHTML = `
      <div style="padding-bottom:10px;">${groupedHtml}</div>
      <div style="background:#fff3cd; padding:8px; border-radius:8px; font-size:0.8rem; color:#856404; margin-bottom:10px;">
        ğŸŸ  ì£¼í™©ìƒ‰ ì ì€ ìê·¹ ì£¼ì˜ ì˜¤ì¼ (ìµœëŒ€ 6ë°©ìš¸ ì œí•œ)
      </div>
      <button class="wide-btn primary" ${isBtnDisabled ? 'disabled' : ''} onclick="calcRecipe()">ğŸŒ¿ 9ml ë ˆì‹œí”¼ ë³´ê¸°</button>
      <div id="recipeResult"></div>
      <div class="nav"><button class="btn" onclick="setView('oil_recipe_intro')">ì´ì „</button></div>`;
  }

  // --- AUTO RECIPE ---
  function renderRecipeAuto() {
    setTitle("Top 5 ì¤‘ ì„ íƒ", "Selection");
    mainContent.innerHTML = `
      <div class="selection-grid">
        ${state.top5ResultOils.map(oil => {
            const isSelected = state.selectedRecipeOils.some(o => o.name === oil.name);
            return `<div class="oil-select-item ${isSelected ? 'selected' : ''}" onclick="toggleAutoRecipeOil('${oil.name}')">
                <div style="font-size:10px; opacity:0.7;">${oil.category}</div>
                ${oil.name} ${oil.isIrritant ? '<span class="warning-dot"></span>':''}
            </div>`;
        }).join('')}
      </div>
      <button class="wide-btn primary" onclick="runAutoRecommend()">âœ¨ ìë™ ë°°í•©í•˜ê¸°</button>
      <div id="recipeResult"></div>
      <div class="nav"><button class="btn" onclick="setView('oil_recipe_intro')">ì´ì „</button></div>`;
  }

  // --- LOGIC ---
  window.checkAndGoAutoRecipe = () => {
      if(!state.top5ResultOils.length) { alert("í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì§„í–‰í•´ì£¼ì„¸ìš”."); return; }
      state.selectedRecipeOils = []; setView('oil_recipe_auto');
  };
  window.toggleRecipeOil = (name) => { toggleOilGeneric(name, 3, renderRecipeManual); };
  window.toggleAutoRecipeOil = (name) => { toggleOilGeneric(name, 2, renderRecipeAuto); };
  
  function toggleOilGeneric(name, max, renderFn) {
      const oil = OIL_DATA.find(o => o.name === name);
      const idx = state.selectedRecipeOils.findIndex(o => o.name === name);
      if(idx > -1) state.selectedRecipeOils.splice(idx,1);
      else {
          if(state.selectedRecipeOils.length >= max) { alert(`${max}ê°œê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.`); return; }
          state.selectedRecipeOils.push(oil);
      }
      renderFn();
  }

  window.runAutoRecommend = () => {
      let picks = [...state.selectedRecipeOils];
      while(picks.length < 3) {
          const cand = OIL_DATA.filter(o => !picks.includes(o));
          picks.push(cand[Math.floor(Math.random() * cand.length)]);
      }
      displayRecipeResult(picks);
  };
  window.calcRecipe = () => { displayRecipeResult(state.selectedRecipeOils); };

  function displayRecipeResult(oils) {
    const resultDiv = document.getElementById('recipeResult');
    
    // 1. ì´ ë°©ìš¸ ìˆ˜ (9ml ê¸°ì¤€ = ì•½ 18ë°©ìš¸)
    const TOTAL_DROPS_TARGET = 18;
    
    // 2. ì˜¤ì¼ ì •ë ¬ (Base -> Middle -> Top)
    const noteWeight = { "B": 3, "M": 2, "T": 1 };
    oils.sort((a,b) => noteWeight[b.note] - noteWeight[a.note]);

    // 3. ê¸°ë³¸ ë¹„ìœ¨ í• ë‹¹ (3ê°œ: 9:5:4 / 2ê°œ: 11:7 / 1ê°œ: 18)
    let ratios = [];
    if(oils.length === 1) ratios = [18];
    else if(oils.length === 2) ratios = [10, 8];
    else ratios = [8, 6, 4]; // í•© 18

    // 4. â˜… ìê·¹ì„± ì˜¤ì¼ ì œí•œ ë¡œì§ (Max 6ë°©ìš¸) â˜…
    const IRRITANT_LIMIT = 6;
    let finalDrops = oils.map((oil, idx) => {
        let d = ratios[idx];
        if (oil.isIrritant && d > IRRITANT_LIMIT) {
             d = IRRITANT_LIMIT; // 6ë°©ìš¸ë¡œ ì œí•œ
        }
        return { ...oil, drops: d };
    });

    const currentTotal = finalDrops.reduce((acc, cur) => acc + cur.drops, 0);
    const hasLimited = finalDrops.some(o => o.isIrritant && ratios[finalDrops.indexOf(o)] > IRRITANT_LIMIT);

    let rows = finalDrops.map(item => `
        <div class="drop-row">
            <span>
                <span style="display:inline-block; width:8px; height:8px; border-radius:50%; background:${item.isIrritant ? '#FF9800':'#4A6C56'}; margin-right:6px;"></span>
                ${item.name} <span style="font-size:0.8rem; color:#888;">(${item.note})</span>
            </span>
            <strong style="color:var(--text-main);">${item.drops} ë°©ìš¸</strong>
        </div>
    `).join('');

    resultDiv.innerHTML = `
      <div class="recipe-box">
        <h3 style="margin:0 0 15px; text-align:center; color:var(--primary); font-size:1.1rem;">ğŸ§ª ë‚˜ë§Œì˜ ë¸”ë Œë”© (9ml ê¸°ì¤€)</h3>
        ${rows}
        <div style="border-top:1px dashed #AACCAE; margin-top:12px; padding-top:12px; text-align:center;">
             <span style="color:#666; font-size:0.9rem;">+ ë‚˜ë¨¸ì§€ ì±„ìš°ê¸°</span><br>
             <strong style="color:var(--accent);">ìºë¦¬ì–´ ì˜¤ì¼ (ì•½ ${9 - (currentTotal*0.05).toFixed(1)}ml)</strong>
        </div>
        ${hasLimited ? `<div class="safety-alert">âš ï¸ ìê·¹ì´ ê°•í•œ ì˜¤ì¼ì€ ì•ˆì „ì„ ìœ„í•´<br>ìµœëŒ€ ${IRRITANT_LIMIT}ë°©ìš¸ë¡œ ì¡°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.</div>` : ''}
      </div>
      <div style="margin-top:15px; display:flex; gap:10px;">
        <button class="btn capture" style="flex:1" onclick="captureResult('recipeResult', 'ë‚˜ë§Œì˜_ë ˆì‹œí”¼')">ğŸ“· ì €ì¥</button>
        <button class="btn" style="flex:1" onclick="setView('menu')">ì²˜ìŒìœ¼ë¡œ</button>
      </div>`;
    resultDiv.scrollIntoView({ behavior: 'smooth' });
  }

  window.setView = (v) => { state.view = v; if(v==='oil_recipe_manual') state.selectedRecipeOils=[]; render(); };
  function setTitle(t, p) { pageTitle.textContent = t; stepPill.textContent = p; }
  window.captureResult = (id, name) => {
    html2canvas(document.getElementById(id), {scale:2, backgroundColor:null}).then(c => {
        let a = document.createElement('a'); a.download = name+'.png'; a.href = c.toDataURL(); a.click();
    });
  };

  render();
})();
</script>
</body>
</html>